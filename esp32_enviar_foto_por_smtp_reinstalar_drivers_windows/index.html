<!DOCTYPE html>
<html lang="es">





<head>
  <meta property="og:url" content="https://imlauera.github.io/esp32_enviar_foto_por_smtp_reinstalar_drivers_windows/">
  <meta property="og:site_name" content="Imlauer">
  <meta property="og:title" content="ESP32 CAM: Como enviar foto por SMTP, solucionar problema de conexión USB en Windows">
  <meta property="og:description" content="Luego de flashear es recomendable hacer esta prueba: Apagá tu modem/router por unos minutos el esp32 se intentará conectar al wifi pero fallará luego prendelo y el ESP32 se debería reconectar automáticamente, si falla es porque programé algo mal XD, (todavía no hice la prueba). Quizás la mejora que se le podría hacer al código es contar cuantas veces se intentó conectar al WiFi si es superior a 30 que reinicie el ESP32 con el comando ESP.restart(); le podes preguntar a ChatGPT seguro te programa algo similar.">
  <meta property="og:locale" content="es_es">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2025-01-02T11:39:01-03:00">
    <meta property="article:modified_time" content="2025-01-02T11:39:01-03:00">
    <meta property="article:tag" content="Esp32">
    <meta property="article:tag" content="Smtp">
    <meta property="article:tag" content="Windows">

  
  <meta itemprop="name" content="ESP32 CAM: Como enviar foto por SMTP, solucionar problema de conexión USB en Windows">
  <meta itemprop="description" content="Luego de flashear es recomendable hacer esta prueba: Apagá tu modem/router por unos minutos el esp32 se intentará conectar al wifi pero fallará luego prendelo y el ESP32 se debería reconectar automáticamente, si falla es porque programé algo mal XD, (todavía no hice la prueba). Quizás la mejora que se le podría hacer al código es contar cuantas veces se intentó conectar al WiFi si es superior a 30 que reinicie el ESP32 con el comando ESP.restart(); le podes preguntar a ChatGPT seguro te programa algo similar.">
  <meta itemprop="datePublished" content="2025-01-02T11:39:01-03:00">
  <meta itemprop="dateModified" content="2025-01-02T11:39:01-03:00">
  <meta itemprop="wordCount" content="807">
  <meta itemprop="keywords" content="Esp32,Smtp,Windows">
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="ESP32 CAM: Como enviar foto por SMTP, solucionar problema de conexión USB en Windows">
  <meta name="twitter:description" content="Luego de flashear es recomendable hacer esta prueba: Apagá tu modem/router por unos minutos el esp32 se intentará conectar al wifi pero fallará luego prendelo y el ESP32 se debería reconectar automáticamente, si falla es porque programé algo mal XD, (todavía no hice la prueba). Quizás la mejora que se le podría hacer al código es contar cuantas veces se intentó conectar al WiFi si es superior a 30 que reinicie el ESP32 con el comando ESP.restart(); le podes preguntar a ChatGPT seguro te programa algo similar.">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
    ESP32 CAM: Como enviar foto por SMTP, solucionar problema de conexión USB en Windows
    
  </title>
  <link rel="stylesheet" href='https://imlauera.github.io/css/site.min.css'>
  <link rel="canonical" href="https://imlauera.github.io/esp32_enviar_foto_por_smtp_reinstalar_drivers_windows/">
  <link rel="alternate" type="application/rss&#43;xml" href="https://imlauera.github.io/index.xml" title="Imlauer">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer">
  <meta name="author" content="Imlauer.">
  <meta name="description" content="Luego de flashear es recomendable hacer esta prueba: Apagá tu modem/router por unos minutos el esp32 se intentará conectar al wifi pero fallará luego prendelo y el ESP32 se debería reconectar automáticamente, si falla es porque programé algo mal XD, (todavía no hice la prueba).
Quizás la mejora que se le podría hacer al código es contar cuantas veces se intentó conectar al WiFi si es superior a 30 que reinicie el ESP32 con el comando ESP.restart(); le podes preguntar a ChatGPT seguro te programa algo similar.">
</head>
<body><nav class="navbar is-transparent " role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://imlauera.github.io/">
      <figure class="image">
        <img alt="" class="is-rounded" src="/img/memememe.jpg">
      </figure>
    </a>
    <a class="navbar-item" href="https://imlauera.github.io/">
      Imlauer
    </a>
    <a class="navbar-item" href="/acerca/">
      Acerca de Mi
    </a>
  </div>
  
  
</nav>

  <section>
    <section class='hero is-small is-link is-fullwidth'>
      <div class="hero-body">
<div class="container">
  <h1 class="title">
    ESP32 CAM: Como enviar foto por SMTP, solucionar problema de conexión USB en Windows
  </h1>
  <h2 class="subtitle">
    <time datetime='2025-01-02T11:39:01-03:00'>
      January 02, 2025
    </time>
    
    <br>
    
    
    
    <a class="tag is-info" href="https://imlauera.github.io/tags/esp32/">Esp32</a>
    
    
    
    
    <a class="tag is-info" href="https://imlauera.github.io/tags/smtp/">Smtp</a>
    
    
    
    
    <a class="tag is-info" href="https://imlauera.github.io/tags/windows/">Windows</a>
    
    
    
  </h2>
</div>

      </div>
    </section>
    <section class="section">
      <div class="container">
<div class="content is-medium">
  <p>Luego de flashear es recomendable hacer esta prueba: Apagá tu modem/router por unos minutos el esp32 se intentará conectar al wifi pero fallará luego prendelo y el ESP32 se debería reconectar automáticamente, si falla es porque programé algo mal XD, (todavía no hice la prueba).
Quizás la mejora que se le podría hacer al código es contar cuantas veces se intentó conectar al WiFi si es superior a 30 que reinicie el ESP32 con el comando <code>ESP.restart();</code> le podes preguntar a ChatGPT seguro te programa algo similar.</p>
<p>Para que este código funcione instalé la biblioteca ESP32 MAIL, lo compilé con ESP32 Wrover Module
<a href="https://mobizt.github.io/ESP-Mail-Client/">https://mobizt.github.io/ESP-Mail-Client/</a></p>
<p>Para poder flashear tenes que puentear los dos pines (GND y IO0) cuando mirás el monitor serie en modo puente no tiene que aparecer ningún mensaje, si no estás en modo puente y flasheaste algo te mostrará el texto. Si estás en linux yo usé Arduino IDE 1.8 no me gusta el ARDUINO 2 y lo ejecuté como root para poder leer el /dev/ttyUSB0, sino me tiraba permiso denegado.</p>
<p><img src="Pines" alt="https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2024/06/ESP32-CAM-FTDI-programmer.png?w=877&amp;quality=100&amp;strip=all&amp;ssl=1"></p>
<p><a href="https://randomnerdtutorials.com/program-upload-code-esp32-cam/">https://randomnerdtutorials.com/program-upload-code-esp32-cam/</a></p>
<h4 id="como-crear-una-contraseña-de-aplicación-para-poder-enviar-correos-desde-gmail-es-mejor-si-usas-otro-proveedor">Como crear una contraseña de aplicación para poder enviar correos desde Gmail (es mejor si usas otro proveedor).</h4>
<p><a href="https://support.google.com/mail/answer/185833?hl=en">https://support.google.com/mail/answer/185833?hl=en</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#include &#34;esp_camera.h&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &#34;SPI.h&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &#34;driver/rtc_io.h&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &#34;ESP32_MailClient.h&#34;</span>
</span></span><span style="display:flex;"><span>//#include <span style="color:#e6db74">&#34;ESP_Mail_Client.h&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;FS.h&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;SPIFFS.h&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;WiFi.h&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const char* ssid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SSID&#34;</span>;
</span></span><span style="display:flex;"><span>const char* password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wifipassword&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>unsigned long previousMillis <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define INTERVAL 180000 </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define sender_email    &#34;correo@gmail.com&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define sender_email_password   &#34;clave de aplicación de google que se obtiene habilitando doble factor de autentication&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define SMTP_Server            &#34;smtp.gmail.com&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define SMTP_Server_Port        465</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define email_subject          &#34;ESP32-CAM Image Capture&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define email_recipient        &#34;otrocorreo@gmail.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define CAMERA_MODEL_AI_THINKER</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if defined(CAMERA_MODEL_AI_THINKER)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define PWDN_GPIO_NUM     32</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define RESET_GPIO_NUM    -1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define XCLK_GPIO_NUM      0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define SIOD_GPIO_NUM     26</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define SIOC_GPIO_NUM     27</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define Y9_GPIO_NUM       35</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define Y8_GPIO_NUM       34</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define Y7_GPIO_NUM       39</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define Y6_GPIO_NUM       36</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define Y5_GPIO_NUM       21</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define Y4_GPIO_NUM       19</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define Y3_GPIO_NUM       18</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define Y2_GPIO_NUM        5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define VSYNC_GPIO_NUM    25</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define HREF_GPIO_NUM     23</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#define PCLK_GPIO_NUM     22</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#else</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#error &#34;Camera model not selected&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SMTPData smtpData;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define IMAGE_PATH &#34;/image.jpg&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>void setup<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  WRITE_PERI_REG<span style="color:#f92672">(</span>RTC_CNTL_BROWN_OUT_REG, 0<span style="color:#f92672">)</span>; //disable brownout detector
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  Serial.begin<span style="color:#f92672">(</span>115200<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  Serial.println<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>  WiFi.begin<span style="color:#f92672">(</span>ssid, password<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  Serial.print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Connecting to WiFi...&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>WiFi.status<span style="color:#f92672">()</span> !<span style="color:#f92672">=</span> WL_CONNECTED<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    delay<span style="color:#f92672">(</span>500<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>    Serial.print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;.&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  Serial.println<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>!SPIFFS.begin<span style="color:#f92672">(</span>true<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Serial.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;An Error has occurred while mounting SPIFFS&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>    ESP.restart<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    delay<span style="color:#f92672">(</span>500<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>    Serial.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SPIFFS mounted successfully&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  Serial.print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IP Address: http://&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  Serial.println<span style="color:#f92672">(</span>WiFi.localIP<span style="color:#f92672">())</span>;
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  camera_config_t config;
</span></span><span style="display:flex;"><span>  config.ledc_channel <span style="color:#f92672">=</span> LEDC_CHANNEL_0;
</span></span><span style="display:flex;"><span>  config.ledc_timer <span style="color:#f92672">=</span> LEDC_TIMER_0;
</span></span><span style="display:flex;"><span>  config.pin_d0 <span style="color:#f92672">=</span> Y2_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_d1 <span style="color:#f92672">=</span> Y3_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_d2 <span style="color:#f92672">=</span> Y4_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_d3 <span style="color:#f92672">=</span> Y5_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_d4 <span style="color:#f92672">=</span> Y6_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_d5 <span style="color:#f92672">=</span> Y7_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_d6 <span style="color:#f92672">=</span> Y8_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_d7 <span style="color:#f92672">=</span> Y9_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_xclk <span style="color:#f92672">=</span> XCLK_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_pclk <span style="color:#f92672">=</span> PCLK_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_vsync <span style="color:#f92672">=</span> VSYNC_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_href <span style="color:#f92672">=</span> HREF_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_sscb_sda <span style="color:#f92672">=</span> SIOD_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_sscb_scl <span style="color:#f92672">=</span> SIOC_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_pwdn <span style="color:#f92672">=</span> PWDN_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.pin_reset <span style="color:#f92672">=</span> RESET_GPIO_NUM;
</span></span><span style="display:flex;"><span>  config.xclk_freq_hz <span style="color:#f92672">=</span> 20000000;
</span></span><span style="display:flex;"><span>  config.pixel_format <span style="color:#f92672">=</span> PIXFORMAT_JPEG;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>psramFound<span style="color:#f92672">()){</span>
</span></span><span style="display:flex;"><span>    config.frame_size <span style="color:#f92672">=</span> FRAMESIZE_UXGA;
</span></span><span style="display:flex;"><span>    config.jpeg_quality <span style="color:#f92672">=</span> 10;
</span></span><span style="display:flex;"><span>    config.fb_count <span style="color:#f92672">=</span> 2;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    config.frame_size <span style="color:#f92672">=</span> FRAMESIZE_SVGA;
</span></span><span style="display:flex;"><span>    config.jpeg_quality <span style="color:#f92672">=</span> 12;
</span></span><span style="display:flex;"><span>    config.fb_count <span style="color:#f92672">=</span> 1;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  esp_err_t err <span style="color:#f92672">=</span> esp_camera_init<span style="color:#f92672">(</span>&amp;config<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>err !<span style="color:#f92672">=</span> ESP_OK<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Serial.printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Camera init failed with error 0x%x&#34;</span>, err<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>void loop<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  // Espera <span style="color:#ae81ff">5</span> minutos para subir la primer foto.
</span></span><span style="display:flex;"><span>  unsigned long currentMillis <span style="color:#f92672">=</span> millis<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>currentMillis - previousMillis &gt;<span style="color:#f92672">=</span> INTERVAL<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>WiFi.status<span style="color:#f92672">()</span> !<span style="color:#f92672">=</span> WL_CONNECTED<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      Serial.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;WiFi disconnected. Reconnecting...&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>      WiFi.disconnect<span style="color:#f92672">()</span>; // Optional: Disconnect first before reconnecting
</span></span><span style="display:flex;"><span>      WiFi.reconnect<span style="color:#f92672">()</span>;  // Reconnect to Wi-Fi
</span></span><span style="display:flex;"><span>      // Wait <span style="color:#66d9ef">until</span> the Wi-Fi is reconnected
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>WiFi.status<span style="color:#f92672">()</span> !<span style="color:#f92672">=</span> WL_CONNECTED<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        delay<span style="color:#f92672">(</span>500<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>        Serial.print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;.&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      Serial.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;WiFi reconnected&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    captureSave_image<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>    sendImage<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    previousMillis <span style="color:#f92672">=</span> currentMillis;  // Remember the time
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Check <span style="color:#66d9ef">if</span> photo capture was successful
</span></span><span style="display:flex;"><span>bool check_photo<span style="color:#f92672">(</span> fs::FS &amp;fs <span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  File f_pic <span style="color:#f92672">=</span> fs.open<span style="color:#f92672">(</span> IMAGE_PATH <span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  unsigned int pic_sz <span style="color:#f92672">=</span> f_pic.size<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span> pic_sz &gt; <span style="color:#ae81ff">100</span> <span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Capture Photo and Save it to SPIFFS
</span></span><span style="display:flex;"><span>void captureSave_image<span style="color:#f92672">(</span> void <span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  camera_fb_t * fb <span style="color:#f92672">=</span> NULL; 
</span></span><span style="display:flex;"><span>  bool ok <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">do</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Serial.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ESP32-CAM capturing photo...&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    fb <span style="color:#f92672">=</span> esp_camera_fb_get<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>!fb<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      Serial.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Failed&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    Serial.printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Picture file name: %s\n&#34;</span>, IMAGE_PATH<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>    File file <span style="color:#f92672">=</span> SPIFFS.open<span style="color:#f92672">(</span>IMAGE_PATH, FILE_WRITE<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>!file<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      Serial.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Failed to open file in writing mode&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      file.write<span style="color:#f92672">(</span>fb-&gt;buf, fb-&gt;len<span style="color:#f92672">)</span>; 
</span></span><span style="display:flex;"><span>      Serial.print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;The picture has been saved in &#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>      Serial.print<span style="color:#f92672">(</span>IMAGE_PATH<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>      Serial.print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; - Size: &#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>      Serial.print<span style="color:#f92672">(</span>file.size<span style="color:#f92672">())</span>;
</span></span><span style="display:flex;"><span>      Serial.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; bytes&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    file.close<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>    esp_camera_fb_return<span style="color:#f92672">(</span>fb<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ok <span style="color:#f92672">=</span> check_photo<span style="color:#f92672">(</span>SPIFFS<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span> <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span> !ok <span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>void sendImage<span style="color:#f92672">(</span> void <span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  smtpData.setLogin<span style="color:#f92672">(</span>SMTP_Server, SMTP_Server_Port, sender_email, sender_email_password<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  smtpData.setSender<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ESP32-CAM&#34;</span>, sender_email<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  smtpData.setPriority<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;High&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  smtpData.setSubject<span style="color:#f92672">(</span>email_subject<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  smtpData.setMessage<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PFA ESP32-CAM Captured Image.&#34;</span>, false<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  smtpData.addRecipient<span style="color:#f92672">(</span>email_recipient<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  smtpData.addAttachFile<span style="color:#f92672">(</span>IMAGE_PATH, <span style="color:#e6db74">&#34;image/jpg&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  smtpData.setFileStorageType<span style="color:#f92672">(</span>MailClientStorageType::SPIFFS<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  smtpData.setSendCallback<span style="color:#f92672">(</span>sendCallback<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>!MailClient.sendMail<span style="color:#f92672">(</span>smtpData<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>    Serial.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Error sending Email, &#34;</span> + MailClient.smtpErrorReason<span style="color:#f92672">())</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  smtpData.empty<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>void sendCallback<span style="color:#f92672">(</span>SendStatus msg<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  Serial.println<span style="color:#f92672">(</span>msg.info<span style="color:#f92672">())</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>El código es de Sara de RandomNerdTutorials pero en el código original no envía un correo cada 5 minutos sino que sólo lo hace cuando prende. Además agregué una condición para verificar si se perdió la conexión WiFi en loop(). <br>
Otra cosa que me faltó agregar pero que podría servir por si se desconecta de la nada el WiFi: <code>WiFi.setSleep(false); </code></p>
<p><a href="https://forum.arduino.cc/t/esp32-keeps-disconnecting-from-wifi-after-sometime/1261448">https://forum.arduino.cc/t/esp32-keeps-disconnecting-from-wifi-after-sometime/1261448</a></p>
<p>Al compilar y subir el programa en Windows Arduino me tiraba un error de <code>esptool.py</code> lo solucioné borrando y reinstalando drivers (Administrador de dispositivos y Puertos COM y borrá todos los drivers que están debajo botón derecho propiedades) mostrados acá:</p>
<p><a href="https://forum.arduino.cc/t/a-fatal-esptool-py-error-occurred-cannot-configure-port-something-went-wrong/1225308/7">https://forum.arduino.cc/t/a-fatal-esptool-py-error-occurred-cannot-configure-port-something-went-wrong/1225308/7</a></p>

</div>


      </div>
    </section>
  </section><script 
src="/quiz/quizdown.js">
</script>
<script 
src="/quiz/quizdownKatex.js">
</script>
<script 
src="/quiz/quizdownHighlight.js">
</script>
<script>quizdown.register(quizdownHighlight).register(quizdownKatex).init()</script> 
<footer class="footer">
  <div class="content has-text-centered">
    
    
    <p>
      
      <a class="" href="https://imlauera.github.io/index.xml" target="_blank">
        <span>
          RSS
        </span>
      </a>
      
      | <a href="https://imlauera.github.io" target="_blank">Andres Imlauer.</a> 

      
      
    </p>
    
  </div>




<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]} })
</script>
</footer>


</body>
</html>
