<!DOCTYPE html>
<html lang="es">





<head>
  <meta property="og:url" content="https://imlauera.github.io/base_de_datos_bloat_plainfiles/">
  <meta property="og:site_name" content="Imlauer">
  <meta property="og:title" content="Las base de datos son bloat mejor usa un archivo de texto plano.">
  <meta property="og:description" content="Las bases de datos son bloat, es mejor usar un archivo texto plano y usar las herramientas de Unix para buscar informacion dentro de ellos.
Aqu√≠ ten√©s una gu√≠a pr√°ctica y realista para usar un archivo de texto plano como ‚Äúbase de datos‚Äù para un colegio, usando solo grep, awk, sed, sort, cut y herramientas Unix. La clave es formato bien definido, un registro por l√≠nea y campos separados de forma consistente.">
  <meta property="og:locale" content="es_es">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2025-12-03T04:01:56-03:00">
    <meta property="article:modified_time" content="2025-12-03T04:01:56-03:00">
    <meta property="article:tag" content="Db">

  
  <meta itemprop="name" content="Las base de datos son bloat mejor usa un archivo de texto plano.">
  <meta itemprop="description" content="Las bases de datos son bloat, es mejor usar un archivo texto plano y usar las herramientas de Unix para buscar informacion dentro de ellos.
Aqu√≠ ten√©s una gu√≠a pr√°ctica y realista para usar un archivo de texto plano como ‚Äúbase de datos‚Äù para un colegio, usando solo grep, awk, sed, sort, cut y herramientas Unix. La clave es formato bien definido, un registro por l√≠nea y campos separados de forma consistente.">
  <meta itemprop="datePublished" content="2025-12-03T04:01:56-03:00">
  <meta itemprop="dateModified" content="2025-12-03T04:01:56-03:00">
  <meta itemprop="wordCount" content="2581">
  <meta itemprop="keywords" content="Db">
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Las base de datos son bloat mejor usa un archivo de texto plano.">
  <meta name="twitter:description" content="Las bases de datos son bloat, es mejor usar un archivo texto plano y usar las herramientas de Unix para buscar informacion dentro de ellos.
Aqu√≠ ten√©s una gu√≠a pr√°ctica y realista para usar un archivo de texto plano como ‚Äúbase de datos‚Äù para un colegio, usando solo grep, awk, sed, sort, cut y herramientas Unix. La clave es formato bien definido, un registro por l√≠nea y campos separados de forma consistente.">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
    Las base de datos son bloat mejor usa un archivo de texto plano.
    
  </title>
  <link rel="stylesheet" href='https://imlauera.github.io/css/site.min.css'>
  <link rel="canonical" href="https://imlauera.github.io/base_de_datos_bloat_plainfiles/">
  <link rel="alternate" type="application/rss&#43;xml" href="https://imlauera.github.io/index.xml" title="Imlauer">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer">
  <meta name="author" content="Imlauer.">
  <meta name="description" content="Las bases de datos son bloat, es mejor usar un archivo texto plano y usar las herramientas de Unix para buscar informacion dentro de ellos.

Aqu√≠ ten√©s una gu√≠a pr√°ctica y realista para usar un archivo de texto plano como ‚Äúbase de datos‚Äù para un colegio, usando solo grep, awk, sed, sort, cut y herramientas Unix.
La clave es formato bien definido, un registro por l√≠nea y campos separados de forma consistente.">
</head>
<body><nav class="navbar is-transparent " role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://imlauera.github.io/">
      <figure class="image">
        <img alt="" class="is-rounded" src="/img/memememe.jpg">
      </figure>
    </a>
    <a class="navbar-item" href="https://imlauera.github.io/">
      Imlauer
    </a>
    <a class="navbar-item" href="/acerca/">
      Acerca de Mi
    </a>
  </div>
  
  
</nav>

  <section>
    <section class='hero is-small is-link is-fullwidth'>
      <div class="hero-body">
<div class="container">
  <h1 class="title">
    Las base de datos son bloat mejor usa un archivo de texto plano.
  </h1>
  <h2 class="subtitle">
    <time datetime='2025-12-03T04:01:56-03:00'>
      December 03, 2025
    </time>
    
    <br>
    
    
    
    <a class="tag is-info" href="https://imlauera.github.io/tags/db/">Db</a>
    
    
    
  </h2>
</div>

      </div>
    </section>
    <section class="section">
      <div class="container">
<div class="content is-medium">
  <p>Las bases de datos son bloat, es mejor usar un archivo texto plano y usar las herramientas de Unix para buscar informacion dentro de ellos.</p>
<hr>
<p>Aqu√≠ ten√©s una <strong>gu√≠a pr√°ctica y realista</strong> para usar <strong>un archivo de texto plano como ‚Äúbase de datos‚Äù</strong> para un colegio, usando solo <strong>grep, awk, sed, sort, cut</strong> y herramientas Unix.
La clave es <strong>formato bien definido</strong>, <strong>un registro por l√≠nea</strong> y <strong>campos separados</strong> de forma consistente.</p>
<hr>
<h1 id="-1-elegir-un-formato-simple-estable-y-f√°cil-de-parsear">‚úÖ <strong>1. Elegir un formato simple, estable y f√°cil de parsear</strong></h1>
<p>El mejor formato para ‚Äúbase de datos en texto plano‚Äù usando Unix es:</p>
<h3 id="formato-tsv-tab-separated-values-separado-por-tab"><strong>Formato: TSV (tab-separated values, separado por TAB)</strong></h3>
<p>Razones:</p>
<ul>
<li>No choca con comas dentro del texto.</li>
<li><code>awk -F '\t'</code> lo lee perfecto.</li>
<li><code>grep</code> funciona igual.</li>
<li>F√°cil de editar en Vim.</li>
</ul>
<hr>
<h1 id="-2-estructura-universal-para-cualquier-tipo-de-registro">‚úÖ <strong>2. Estructura universal para cualquier tipo de registro</strong></h1>
<p>Us√° un <strong>‚Äúschema‚Äù fijo</strong>:</p>
<pre tabindex="0"><code>TYPE    ID      DATE        FIELD1      FIELD2     FIELD3     EXTRA
</code></pre><h3 id="campos-recomendados">Campos recomendados:</h3>
<ul>
<li><code>TYPE</code>: el tipo de dato ‚Üí <code>DOCENTE</code>, <code>ALUMNO</code>, <code>ASISTENCIA</code>, <code>LICENCIA</code>, <code>AMON</code>, <code>TUTOR</code>, etc.</li>
<li><code>ID</code>: identificador √∫nico ‚Üí DNI, legajo o c√≥digo.</li>
<li><code>DATE</code>: formato est√°ndar ‚Üí <code>2025-03-04</code></li>
<li><code>FIELD1..FIELDn</code>: depende del tipo.</li>
<li><code>EXTRA</code>: texto libre opcional.</li>
</ul>
<hr>
<h1 id="-3-ejemplos-reales">‚úÖ <strong>3. Ejemplos reales</strong></h1>
<h3 id="docentes"><strong>Docentes</strong></h3>
<pre tabindex="0"><code>DOCENTE  20300300    2025-03-01  ingreso     Juan Perez     Matem√°tica
DOCENTE  20300300    2025-03-15  licencia    enfermedad     2-dias
</code></pre><h3 id="alumnos"><strong>Alumnos</strong></h3>
<pre tabindex="0"><code>ALUMNO   55022110    2025-03-01  ingreso     Lopez Maria    2B
TUTOR    55022110    2025-03-01  tutor       Carlos Lopez   padre
</code></pre><h3 id="asistencias"><strong>Asistencias</strong></h3>
<pre tabindex="0"><code>ASIST    55022110    2025-03-04  presente    2B
ASIST    55022110    2025-03-05  ausente     2B
</code></pre><h3 id="amonestaciones"><strong>Amonestaciones</strong></h3>
<pre tabindex="0"><code>AMON     55022110    2025-03-05  leve        celular        profesorX
AMON     55022110    2025-03-10  grave       conducta       preceptorY
</code></pre><hr>
<h1 id="-4-c√≥mo-consultar-r√°pido-con-unix">‚úÖ <strong>4. C√≥mo consultar r√°pido con Unix</strong></h1>
<h3 id="-todos-los-registros-de-un-alumno">‚ñ† Todos los registros de un alumno:</h3>
<pre tabindex="0"><code>grep -P &#34;\t55022110\t&#34; base2025.tsv
</code></pre><h3 id="-solo-asistencias">‚ñ† Solo asistencias:</h3>
<pre tabindex="0"><code>grep &#34;^ASIST&#34; base2025.tsv
</code></pre><h3 id="-asistencias-de-un-alumno">‚ñ† Asistencias de un alumno:</h3>
<pre tabindex="0"><code>awk -F &#39;\t&#39; &#39;$1==&#34;ASIST&#34; &amp;&amp; $2==&#34;55022110&#34;&#39; base2025.tsv
</code></pre><h3 id="-cantidad-de-ausencias">‚ñ† Cantidad de ausencias:</h3>
<pre tabindex="0"><code>awk -F &#39;\t&#39; &#39;$1==&#34;ASIST&#34; &amp;&amp; $2==&#34;55022110&#34; &amp;&amp; $4==&#34;ausente&#34; {c++} END {print c}&#39; base2025.tsv
</code></pre><h3 id="-sanciones-de-un-curso">‚ñ† Sanciones de un curso:</h3>
<pre tabindex="0"><code>awk -F &#39;\t&#39; &#39;$1==&#34;AMON&#34; &amp;&amp; $6==&#34;2B&#34;&#39; base2025.tsv
</code></pre><hr>
<h1 id="-5-c√≥mo-agregar-un-registro-desde-bash">‚úÖ <strong>5. C√≥mo agregar un registro desde Bash</strong></h1>
<p>Hacete un script:</p>
<h3 id="addsh"><code>add.sh</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh
</span></span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span> &gt;&gt; base2025.tsv
</span></span></code></pre></div><p>Uso:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./add.sh <span style="color:#e6db74">&#34;ASIST\t55022110\t2025-03-06\tpresente\t2B&#34;</span>
</span></span></code></pre></div><hr>
<h1 id="-6-c√≥mo-validar-datos">‚úÖ <strong>6. C√≥mo validar datos</strong></h1>
<p>Pod√©s agregar checks con awk:</p>
<pre tabindex="0"><code>awk -F &#39;\t&#39; &#39;NF &lt; 4 { print &#34;Registro inv√°lido:&#34;, $0}&#39; base2025.tsv
</code></pre><hr>
<h1 id="-7-organizaci√≥n-por-a√±o">‚úÖ <strong>7. Organizaci√≥n por a√±o</strong></h1>
<p>Te recomiendo:</p>
<pre tabindex="0"><code>/datos-colegio/
    base2025.tsv
    base2026.tsv
    base2027.tsv
</code></pre><p>Un archivo grande por a√±o es perfecto.</p>
<hr>
<h1 id="-8-opcional-separar-por-tablas-virtuales">‚úÖ <strong>8. Opcional: separar por ‚Äútablas virtuales‚Äù</strong></h1>
<p>Si quer√©s dividir un poco:</p>
<pre tabindex="0"><code>docentes2025.tsv
alumnos2025.tsv
asistencias2025.tsv
amonestaciones2025.tsv
tutores2025.tsv
</code></pre><p>Pero tu idea de <strong>un solo archivo</strong> es totalmente v√°lida ‚Äî solo necesit√°s el campo <code>TYPE</code>.</p>
<hr>
<h1 id="-quer√©s-que-te-genere-un-schema-completo-y-lista-de-comandos-√∫tiles-para-cada-tipo-de-dato">‚ö° ¬øQuer√©s que te genere un <em>schema</em> completo y lista de comandos √∫tiles para cada tipo de dato?</h1>
<p>Puedo armarte un ‚Äúmanual del sistema‚Äù con todo predefinido.</p>
<hr>
<p>You can absolutely use a <strong>plain text file as a database</strong> in Unix. This is classic Unix philosophy: <em>‚ÄúText is the universal interface.‚Äù</em>
Below are <strong>practical patterns</strong> depending on how you want to store and query data ‚Äî all without jq, without SQLite, without JSON ‚Äî just text + grep/awk/sed.</p>
<hr>
<h1 id="-1-choose-a-format-custom-plain-text">‚úÖ 1. Choose a Format (custom plain text)</h1>
<p>The simplest and most robust <strong>flat-file database</strong> formats are:</p>
<h3 id="a-keyvalue-one-record-per-line"><strong>A) KEY=VALUE (one record per line)</strong></h3>
<pre tabindex="0"><code>id=1 name=&#34;John Doe&#34; age=30
id=2 name=&#34;Alice&#34; age=25
</code></pre><h3 id="b-csv-comma-separated"><strong>B) CSV (comma separated)</strong></h3>
<pre tabindex="0"><code>1,John Doe,30
2,Alice,25
</code></pre><h3 id="c-pipetab-separated"><strong>C) Pipe/Tab separated</strong></h3>
<pre tabindex="0"><code>1|John Doe|30
2|Alice|25
</code></pre><h3 id="d-one-file-per-record-directory-database"><strong>D) One file per record (directory database)</strong></h3>
<pre tabindex="0"><code>db/
  1.txt
  2.txt
</code></pre><p>Each file contains arbitrary text.</p>
<hr>
<h1 id="-2-how-to-query-the-database">‚úÖ 2. How to Query the ‚ÄúDatabase‚Äù</h1>
<h2 id="-search-rows-by-field">üîç Search rows by field</h2>
<h3 id="keyvalue-format"><strong>KEY=VALUE format</strong></h3>
<p>Find all entries where name contains &ldquo;Alice&rdquo;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>grep <span style="color:#e6db74">&#39;name=&#34;Alice&#34;&#39;</span> db.txt
</span></span></code></pre></div><p>Find id=2:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>grep <span style="color:#e6db74">&#39;^id=2 &#39;</span> db.txt
</span></span></code></pre></div><h3 id="csv-example">CSV example</h3>
<p>Find records whose first column is &ldquo;2&rdquo;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>awk -F, <span style="color:#e6db74">&#39;$1 == 2&#39;</span> db.csv
</span></span></code></pre></div><hr>
<h1 id="-3-insert-new-record">üîÑ 3. Insert new record</h1>
<p>Append:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;id=3 name=&#34;Bob&#34; age=50&#39;</span> &gt;&gt; db.txt
</span></span></code></pre></div><hr>
<h1 id="-4-update-a-record">‚úè 4. Update a record</h1>
<p>Replace age for id=1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#39;s/^id=1 .*/id=1 name=&#34;John Doe&#34; age=31/&#39;</span> db.txt
</span></span></code></pre></div><hr>
<h1 id="-5-delete-a-record">‚ùå 5. Delete a record</h1>
<p>Delete id=2:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#39;/^id=2 /d&#39;</span> db.txt
</span></span></code></pre></div><hr>
<h1 id="-6-example-flat-file-database-implementation">üî• 6. Example Flat-File Database Implementation</h1>
<h3 id="dbsh"><strong>db.sh</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DB<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;db.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>add<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;id=</span>$1<span style="color:#e6db74"> name=\&#34;</span>$2<span style="color:#e6db74">\&#34; age=</span>$3<span style="color:#e6db74">&#34;</span> &gt;&gt; <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>get<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    grep <span style="color:#e6db74">&#34;^id=</span>$1<span style="color:#e6db74"> &#34;</span> <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>delete<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    sed -i <span style="color:#e6db74">&#34;/^id=</span>$1<span style="color:#e6db74"> /d&#34;</span> <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>update_age<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    sed -i <span style="color:#e6db74">&#34;s/^id=</span>$1<span style="color:#e6db74"> .*/id=</span>$1<span style="color:#e6db74"> name=\&#34;</span>$2<span style="color:#e6db74">\&#34; age=</span>$3<span style="color:#e6db74">/&#34;</span> <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Usage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>./db.sh add <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#34;John Doe&#34;</span> <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>./db.sh add <span style="color:#ae81ff">2</span> <span style="color:#e6db74">&#34;Alice&#34;</span> <span style="color:#ae81ff">25</span>
</span></span><span style="display:flex;"><span>./db.sh get <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>./db.sh update_age <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#34;John Doe&#34;</span> <span style="color:#ae81ff">31</span>
</span></span><span style="display:flex;"><span>./db.sh delete <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><hr>
<h1 id="-7-alternative-directory-per-record">üìÇ 7. Alternative: directory per record</h1>
<pre tabindex="0"><code>db/
  1
  2
</code></pre><p>Create:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;name=Alice&#34;</span> &gt; db/2
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;age=25&#34;</span> &gt;&gt; db/2
</span></span></code></pre></div><p>Search:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>grep -R <span style="color:#e6db74">&#34;Alice&#34;</span> db/
</span></span></code></pre></div><hr>
<h1 id="-when-is-this-useful">‚≠ê When is this useful?</h1>
<p>‚úî shell scripts
‚úî embedded devices
‚úî tiny systems
‚úî config management
‚úî low data volume (&lt;50k records)
‚úî no dependencies
‚úî grep/awk/sed are extremely fast</p>
<hr>
<h1 id="-when-it-falls-apart">‚ö† When it falls apart</h1>
<p>‚ùå hundreds of thousands of rows
‚ùå concurrent writes
‚ùå complex queries (joins, ordering, types)</p>
<hr>
<h1 id="if-you-want-i-can">If you want, I can:</h1>
<ul>
<li>design a full mini-database system in shell</li>
<li>give you CRUD helpers</li>
<li>make an ‚ÄúSQL-like‚Äù interface in bash</li>
<li>design indexing for fast lookups (using grep caches)</li>
</ul>
<p>Just tell me your ideal workflow.</p>
<hr>
<p>Nice ‚Äî you want a <em>practical</em>, file-based ‚Äúdatabase‚Äù using only Unix tools. Below is a focused, pragmatic guide + ready-to-run shell toolkit you can copy-paste and use. It covers data layout choices, common operations (CRUD + queries), performance &amp; safety tips, and a simple script (<code>plaindb.sh</code>) that implements insert/find/update/delete on newline-delimited JSON (NDJSON) and on delimited CSV/TSV. I thought deeper about scale, concurrency, indexing, and schema evolution so you don&rsquo;t get burned later.</p>
<h1 id="why-plain-files-quick-proscons">Why plain files (quick pros/cons)</h1>
<p><strong>Pros</strong></p>
<ul>
<li>Simple, transparent, easy to version with git.</li>
<li>No DB server, low dependency surface.</li>
<li>Fast for many read-heavy workloads using grep/rg/awk/jq.
<strong>Cons</strong></li>
<li>No transactions unless you implement locking/atomic writes.</li>
<li>Harder to scale and do complex joins/queries compared to a DB.</li>
<li>Requires careful handling for concurrency, schema evolution, and backups.</li>
</ul>
<h1 id="recommended-file-formats">Recommended file formats</h1>
<ol>
<li>
<p><strong>NDJSON (newline-delimited JSON)</strong> ‚Äî each line is a JSON object. Best for structured records, works great with <code>jq</code>.</p>
<ul>
<li>Example: <code>users.ndjson</code></li>
<li><code>{&quot;id&quot;:1,&quot;name&quot;:&quot;A&quot;,&quot;email&quot;:&quot;a@x.com&quot;}</code></li>
</ul>
</li>
<li>
<p><strong>CSV/TSV</strong> ‚Äî great for tabular data and fast parsing with <code>awk</code>, <code>cut</code>.</p>
<ul>
<li>Use <code>\t</code> (TSV) to avoid comma-escaping headaches.</li>
</ul>
</li>
<li>
<p><strong>Flat key-value</strong> ‚Äî <code>key:value</code> per line for tiny lookup tables.</p>
</li>
<li>
<p><strong>Inverted index files</strong> ‚Äî precomputed index files to support fast full-text lookups.</p>
</li>
</ol>
<h1 id="tools-to-use-short">Tools to use (short)</h1>
<ul>
<li><code>grep</code> / <code>rg</code> (ripgrep) ‚Äî text search</li>
<li><code>awk</code> ‚Äî field processing, aggregations, joins-ish</li>
<li><code>sed</code> ‚Äî in-place edits / transforms</li>
<li><code>jq</code> ‚Äî JSON querying and mutation</li>
<li><code>cut</code>, <code>sort</code>, <code>uniq</code>, <code>join</code> ‚Äî selection and joins on sorted files</li>
<li><code>flock</code> ‚Äî file locking for safe concurrent writes</li>
<li><code>mv</code>/<code>cp</code> technique ‚Äî atomic replace (<code>mv tmp file</code>)</li>
<li><code>gzip</code>/<code>xz</code> ‚Äî compress cold data</li>
<li><code>git</code> ‚Äî version your files for history &amp; lightweight rollback</li>
<li><code>fzf</code> ‚Äî interactive selection</li>
</ul>
<hr>
<h1 id="patterns--examples">Patterns &amp; examples</h1>
<h2 id="1-ndjson-append-find-update-delete">1) NDJSON: append, find, update, delete</h2>
<p>File: <code>users.ndjson</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">1</span>,<span style="color:#f92672">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Alice&#34;</span>,<span style="color:#f92672">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;alice@example.com&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">2</span>,<span style="color:#f92672">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Bob&#34;</span>,<span style="color:#f92672">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;bob@example.com&#34;</span>}
</span></span></code></pre></div><h3 id="insert-append-safely">Insert (append safely)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># create a new record and append atomically</span>
</span></span><span style="display:flex;"><span>record<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{&#34;id&#34;:3,&#34;name&#34;:&#34;Carol&#34;,&#34;email&#34;:&#34;carol@example.com&#34;}&#39;</span>
</span></span><span style="display:flex;"><span>printf <span style="color:#e6db74">&#39;%s\n&#39;</span> <span style="color:#e6db74">&#34;</span>$record<span style="color:#e6db74">&#34;</span> &gt;&gt; users.ndjson
</span></span><span style="display:flex;"><span><span style="color:#75715e"># better: use flock for multi-writer safety (see script below)</span>
</span></span></code></pre></div><h3 id="find-records">Find records</h3>
<ul>
<li>Full-text with grep:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>grep -i <span style="color:#e6db74">&#39;alice&#39;</span> users.ndjson
</span></span></code></pre></div><ul>
<li>Field-level with jq:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c <span style="color:#e6db74">&#39;select(.email==&#34;alice@example.com&#34;)&#39;</span> users.ndjson
</span></span></code></pre></div><h3 id="select-columns-project">Select columns (project)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -r <span style="color:#e6db74">&#39;.id, .name&#39;</span> users.ndjson    <span style="color:#75715e"># prints each field on a new line (not ideal)</span>
</span></span><span style="display:flex;"><span>jq -r <span style="color:#e6db74">&#39;. | [.id, .name] | @tsv&#39;</span> users.ndjson  <span style="color:#75715e"># id&lt;TAB&gt;name</span>
</span></span></code></pre></div><h3 id="update-a-record-idempotent-pattern">Update a record (idempotent pattern)</h3>
<p>Can&rsquo;t modify in-place reliably ‚Äî create a new file then move:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq <span style="color:#e6db74">&#39;if .id==2 then .email=&#34;bob@new.com&#34; else . end&#39;</span> users.ndjson &gt; users.ndjson.tmp
</span></span><span style="display:flex;"><span>mv users.ndjson.tmp users.ndjson
</span></span></code></pre></div><p>If multiple writers exist, use <code>flock</code> to protect the critical section (script later).</p>
<h3 id="delete">Delete</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq <span style="color:#e6db74">&#39;select(.id != 2)&#39;</span> users.ndjson &gt; users.ndjson.tmp <span style="color:#f92672">&amp;&amp;</span> mv users.ndjson.tmp users.ndjson
</span></span></code></pre></div><h2 id="2-csvtsv-with-awk">2) CSV/TSV with awk</h2>
<p>File: <code>products.tsv</code> (header: id<!-- raw HTML omitted -->name<!-- raw HTML omitted -->price)</p>
<pre tabindex="0"><code>id	name	price
1	Widget	12.50
2	Gizmo	9.99
</code></pre><h3 id="find-where-price--10">Find where price &gt; 10</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>awk -F<span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;NR==1{print; next} $3+0 &gt; 10&#39;</span> products.tsv
</span></span></code></pre></div><h3 id="group-by-and-count">Group by and count</h3>
<p>Count products by name prefix:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>awk -F<span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;NR&gt;1 {prefix=substr($2,1,3); counts[prefix]++} END{for (k in counts) print k, counts[k]}&#39;</span> products.tsv | sort -k2 -n -r
</span></span></code></pre></div><h3 id="join-two-files-both-sorted-by-key">Join two files (both sorted by key)</h3>
<p><code>join</code> requires files sorted on join field:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># assume customers.tsv and orders.tsv keyed by customer_id in column1</span>
</span></span><span style="display:flex;"><span>join -t<span style="color:#e6db74">$&#39;\t&#39;</span> -1 <span style="color:#ae81ff">1</span> -2 <span style="color:#ae81ff">1</span> &lt;<span style="color:#f92672">(</span>sort -k1,1 customers.tsv<span style="color:#f92672">)</span> &lt;<span style="color:#f92672">(</span>sort -k1,1 orders.tsv<span style="color:#f92672">)</span>
</span></span></code></pre></div><h2 id="3-indexing-for-speed-simple-inverted-index">3) Indexing for speed (simple inverted index)</h2>
<p>If you have lots of text and <code>grep</code> becomes slow / you need targeted search, create an index mapping token ‚Üí list of record IDs.</p>
<p>Example pipeline to build a basic inverted index (tokenized lowercased words):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># input: docs.ndjson each line {&#34;id&#34;:123, &#34;text&#34;:&#34;...&#34;}</span>
</span></span><span style="display:flex;"><span>jq -r <span style="color:#e6db74">&#39;. | [.id, .text] | @tsv&#39;</span> docs.ndjson <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  | tr <span style="color:#e6db74">&#39;[:upper:]&#39;</span> <span style="color:#e6db74">&#39;[:lower:]&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  | awk -F<span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;{id=$1; text=$2; gsub(/[^a-z0-9]+/,&#34; &#34;,text); split(text, a, &#34; &#34;); for(i in a) if(length(a[i])&gt;1) print a[i] &#34;\t&#34; id}&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  | sort -k1,1 -u <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  | awk -F<span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;{word=$1; id=$2; ids[word]=ids[word]?ids[word] &#34;,&#34; id : id} END{for (w in ids) print w &#34;\t&#34; ids[w]}&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  &gt; index.tsv
</span></span></code></pre></div><p>Lookup:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>grep -P <span style="color:#e6db74">&#39;^keyword\t&#39;</span> index.tsv
</span></span><span style="display:flex;"><span><span style="color:#75715e"># parse list of ids and then pull records from ndjson using jq or grep -Ff</span>
</span></span></code></pre></div><h2 id="4-transactions--concurrency-flock--atomic-move">4) Transactions &amp; concurrency (flock + atomic move)</h2>
<p>Example pattern for safe writes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>  flock -x <span style="color:#ae81ff">200</span> <span style="color:#f92672">||</span> exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># make changes in a tmp file</span>
</span></span><span style="display:flex;"><span>  jq <span style="color:#e6db74">&#39;...update...&#39;</span> users.ndjson &gt; users.ndjson.tmp
</span></span><span style="display:flex;"><span>  mv users.ndjson.tmp users.ndjson
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span> 200&gt;users.ndjson.lock
</span></span></code></pre></div><ul>
<li><code>flock -x</code> grabs exclusive lock on file descriptor 200.</li>
<li>Always write to a <code>.tmp</code> and <code>mv</code> to replace atomically.</li>
</ul>
<h2 id="5-backups--snapshots">5) Backups &amp; snapshots</h2>
<ul>
<li>Periodic snapshots: <code>cp users.ndjson users.$(date +%Y%m%d%H%M).ndjson</code></li>
<li>Lightweight: commit changes to git (<code>git add *.ndjson &amp;&amp; git commit -m &quot;snapshot&quot;</code>).</li>
<li>For big files, use incremental rsync to remote.</li>
</ul>
<h2 id="6-validation--schema-evolution">6) Validation &amp; schema evolution</h2>
<ul>
<li>Keep a small schema file <code>schema.json</code> that documents required fields and types.</li>
<li>Validate new records with <code>jq</code> filter before appending:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -e <span style="color:#e6db74">&#39;(.id|type==&#34;number&#34;) and (.email|test(&#34;@&#34;))&#39;</span> <span style="color:#f92672">&lt;&lt;&lt;</span><span style="color:#e6db74">&#34;</span>$candidate<span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><ul>
<li>For migration: write a one-shot <code>jq</code> or <code>awk</code> migration script that produces a new file, test it, then replace.</li>
</ul>
<hr>
<h1 id="ready-to-use-toolkit-plaindbsh">Ready-to-use toolkit: <code>plaindb.sh</code></h1>
<p>Copy this script and put it in your <code>$PATH</code> (<code>chmod +x plaindb.sh</code>). It implements simple CRUD on an NDJSON file with locking.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># plaindb.sh - minimal NDJSON &#34;db&#34; operations: insert, find, update, delete, list</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Usage: plaindb.sh &lt;dbfile&gt; &lt;cmd&gt; [args...]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Requires: jq, flock, mktemp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DB<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>; shift
</span></span><span style="display:flex;"><span>CMD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>; shift
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LOCK<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DB<span style="color:#e6db74">}</span><span style="color:#e6db74">.lock&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>usage<span style="color:#f92672">(){</span> cat <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Usage: $0 &lt;dbfile&gt; &lt;cmd&gt; [args...]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Commands:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  insert  &lt;json&gt;                 Append a JSON record (string)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  find    &lt;jq-filter&gt;            Print matching records (jq filter)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  list                           Print all records
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  update  &#39;&lt;jq-update&gt;&#39;          Apply jq program to all records (e.g. &#39;if .id==2 then .name=&#34;X&#34; else . end&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  delete  &#39;&lt;jq-condition&gt;&#39;       Delete records matching condition (jq select; e.g. &#39;.id==2&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">||</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$CMD<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span> usage; exit 1; <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>dirname <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> 2&gt;/dev/null <span style="color:#f92672">||</span> true
</span></span><span style="display:flex;"><span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DB:=db.ndjson<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>with_lock<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># usage: with_lock &lt;command...&gt;</span>
</span></span><span style="display:flex;"><span>  exec 200&gt;<span style="color:#e6db74">&#34;</span>$LOCK<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  flock -x <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  flock -u <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;</span>$CMD<span style="color:#e6db74">&#34;</span> in
</span></span><span style="display:flex;"><span>  insert<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    json<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ! echo <span style="color:#e6db74">&#34;</span>$json<span style="color:#e6db74">&#34;</span> | jq -e . &gt;/dev/null 2&gt;&amp;1; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>      echo <span style="color:#e6db74">&#34;invalid json&#34;</span> &gt;&amp;2; exit <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># append under lock</span>
</span></span><span style="display:flex;"><span>    with_lock bash -c <span style="color:#e6db74">&#34;printf &#39;%s\n&#39; \&#34;</span>$json<span style="color:#e6db74">\&#34; &gt;&gt; &#39;</span>$DB<span style="color:#e6db74">&#39;&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  find<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$filter<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span> filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;.&#39;</span>; <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># safe read, no write locking necessary</span>
</span></span><span style="display:flex;"><span>    jq -c <span style="color:#e6db74">&#34;</span>$filter<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  list<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    jq -c <span style="color:#e6db74">&#39;.&#39;</span> <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  update<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    prog<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    tmp<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>mktemp <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DB<span style="color:#e6db74">}</span><span style="color:#e6db74">.tmp.XXXX&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    with_lock bash -c <span style="color:#e6db74">&#34;jq -c &#39;</span>$prog<span style="color:#e6db74">&#39; &#39;</span>$DB<span style="color:#e6db74">&#39; &gt; &#39;</span>$tmp<span style="color:#e6db74">&#39; &amp;&amp; mv &#39;</span>$tmp<span style="color:#e6db74">&#39; &#39;</span>$DB<span style="color:#e6db74">&#39;&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  delete<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    cond<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    tmp<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>mktemp <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DB<span style="color:#e6db74">}</span><span style="color:#e6db74">.tmp.XXXX&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    with_lock bash -c <span style="color:#e6db74">&#34;jq -c \&#34;select( ( </span>$cond<span style="color:#e6db74"> ) | not )\&#34; &#39;</span>$DB<span style="color:#e6db74">&#39; &gt; &#39;</span>$tmp<span style="color:#e6db74">&#39; &amp;&amp; mv &#39;</span>$tmp<span style="color:#e6db74">&#39; &#39;</span>$DB<span style="color:#e6db74">&#39;&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  *<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    usage; exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">esac</span>
</span></span></code></pre></div><p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># insert</span>
</span></span><span style="display:flex;"><span>./plaindb.sh users.ndjson insert <span style="color:#e6db74">&#39;{&#34;id&#34;:1,&#34;name&#34;:&#34;Alice&#34;}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># find by id</span>
</span></span><span style="display:flex;"><span>./plaindb.sh users.ndjson find <span style="color:#e6db74">&#39;select(.id==1)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># update</span>
</span></span><span style="display:flex;"><span>./plaindb.sh users.ndjson update <span style="color:#e6db74">&#39;if .id==1 then .email=&#34;a@x.com&#34; else . end&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># delete</span>
</span></span><span style="display:flex;"><span>./plaindb.sh users.ndjson delete <span style="color:#e6db74">&#39;.id==1&#39;</span>
</span></span></code></pre></div><hr>
<h1 id="advanced-tips-thinking-deeper">Advanced tips (thinking deeper)</h1>
<ul>
<li><strong>Search performance</strong>: <code>rg</code> (ripgrep) is much faster than <code>grep</code>. For enormous files, split data by sharding keys (year, prefix), or maintain indexes.</li>
<li><strong>Atomic counters</strong>: maintain a small file <code>next_id</code> and <code>flock</code> it to safely increment IDs.</li>
<li><strong>Multi-field joins</strong>: sort files on join keys and use <code>join</code>. For complex joins, it&rsquo;s often simpler to load small sets into memory with <code>awk</code> associative arrays.</li>
<li><strong>Partial reads</strong>: store large blobs separately (e.g., <code>blobs/&lt;id&gt;.dat</code>) and keep metadata in the main NDJSON.</li>
<li><strong>Full-text search</strong>: if you need advanced text queries (stemming, ranking), either maintain an index or use <code>sqlite FTS</code> (that&rsquo;s a DB‚Äîbut it&rsquo;s a single file).</li>
<li><strong>Monitoring &amp; metrics</strong>: keep a <code>metrics.log</code> file with line-oriented events (timestamped) and roll it daily.</li>
<li><strong>Immutable append-only log</strong>: prefer append-only files and periodic compaction‚Äîthis makes crash recovery trivial. Compaction script reads file, removes tombstones, writes compacted file, swaps atomically.</li>
<li><strong>Encryption</strong>: use <code>gpg --encrypt</code> for at-rest, <code>gpg --decrypt</code> when reading; or use <code>age</code>.</li>
<li><strong>Testing &amp; CI</strong>: add schema tests that <code>jq</code>-validate every new commit to the repo.</li>
</ul>
<hr>
<h1 id="quick-cheatsheet">Quick cheatsheet</h1>
<ul>
<li><code>grep -i foo file</code> ‚Äî fast text search</li>
<li><code>jq -c 'select(.field==&quot;x&quot;)' file</code> ‚Äî filter NDJSON</li>
<li><code>awk -F'\t' '$3&gt;10' file.tsv</code> ‚Äî numeric filter on column 3</li>
<li><code>sort -k1,1 file | join -t$'\t' -1 1 -2 1 file2</code> ‚Äî join on column1</li>
<li><code>flock -x 200; mv tmp file;</code> ‚Äî atomic replacement with lock</li>
<li><code>git add *.ndjson &amp;&amp; git commit -m &quot;snapshot&quot;</code> ‚Äî snapshot your DB state</li>
</ul>
<hr>
<p>If you want, I can:</p>
<ul>
<li>produce a slightly fancier CLI (with <code>getopts</code>, <code>--where</code>, <code>--select</code>) to make ad-hoc queries easier,</li>
<li>show how to build a tiny inverted index for full-text search and a lookup tool that returns top-N results,</li>
<li>or tailor the scripts for CSV/TSV only (no jq).</li>
</ul>
<p>Which of those should I give you next?</p>
<hr>
<p>If you want to use <strong>jq</strong> as your ‚Äúdatabase engine,‚Äù the <strong>best possible format</strong> is:</p>
<h1 id="-ndjson-newline-delimited-json">‚úÖ NDJSON (Newline-Delimited JSON)</h1>
<p>One JSON object <strong>per line</strong>:</p>
<p><code>users.ndjson</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">1</span>, <span style="color:#f92672">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#f92672">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;alice@example.com&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">2</span>, <span style="color:#f92672">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Bob&#34;</span>, <span style="color:#f92672">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;bob@example.com&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">3</span>, <span style="color:#f92672">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Carol&#34;</span>, <span style="color:#f92672">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;carol@example.com&#34;</span>}
</span></span></code></pre></div><p>No commas, no arrays, no brackets ‚Äî <strong>just one JSON per line</strong>.
This is the format used by big data tools (Elasticsearch, Firehose, Hadoop, etc.).</p>
<hr>
<h1 id="-1-find-query-with-jq">‚úÖ 1. FIND (query with jq)</h1>
<p>List <em>all</em> records:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c . users.ndjson
</span></span></code></pre></div><p>Find by name:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c <span style="color:#e6db74">&#39;select(.name == &#34;Alice&#34;)&#39;</span> users.ndjson
</span></span></code></pre></div><p>Case-insensitive:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c <span style="color:#e6db74">&#39;select(.name | ascii_downcase == &#34;alice&#34;)&#39;</span> users.ndjson
</span></span></code></pre></div><p>Find by ID:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c <span style="color:#e6db74">&#39;select(.id == 2)&#39;</span> users.ndjson
</span></span></code></pre></div><p>Search email ending in <code>.com</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c <span style="color:#e6db74">&#39;select(.email | endswith(&#34;.com&#34;))&#39;</span> users.ndjson
</span></span></code></pre></div><hr>
<h1 id="-2-insert-append">‚úÖ 2. INSERT (append)</h1>
<p>Append a new object:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;{&#34;id&#34;:4, &#34;name&#34;:&#34;David&#34;, &#34;email&#34;:&#34;david@example.com&#34;}&#39;</span> &gt;&gt; users.ndjson
</span></span></code></pre></div><hr>
<h1 id="-3-delete-a-record">‚úÖ 3. DELETE a record</h1>
<p>Delete ID=3:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c <span style="color:#e6db74">&#39;select(.id != 3)&#39;</span> users.ndjson <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  &gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp users.ndjson
</span></span></code></pre></div><p>Delete every Bob:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c <span style="color:#e6db74">&#39;select(.name != &#34;Bob&#34;)&#39;</span> users.ndjson <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  &gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp users.ndjson
</span></span></code></pre></div><hr>
<h1 id="-4-update-a-record-1">‚úÖ 4. UPDATE a record</h1>
<p>Example: change Bob‚Äôs email:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  if .id == 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  then .email = &#34;bob@newmail.com&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  else .
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span> users.ndjson &gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp users.ndjson
</span></span></code></pre></div><p>Update multiple fields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  if .id == 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  then .name = &#34;Carolina&#34; | .email = &#34;caro@example.com&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  else .
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span> users.ndjson &gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp users.ndjson
</span></span></code></pre></div><hr>
<h1 id="-5-sort-the-database">‚úÖ 5. SORT the &ldquo;database&rdquo;</h1>
<p>Sort by ID:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c . users.ndjson | sort -n -t: -k2
</span></span></code></pre></div><p>Better way (jq loads fully, sorts, outputs NDJSON):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c -s <span style="color:#e6db74">&#39;sort_by(.id)[]&#39;</span> users.ndjson &gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp users.ndjson
</span></span></code></pre></div><p>(<code>-s</code> = &ldquo;slurp&rdquo; = load entire file)</p>
<p>Sort by name:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq -c -s <span style="color:#e6db74">&#39;sort_by(.name)[]&#39;</span> users.ndjson &gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp users.ndjson
</span></span></code></pre></div><hr>
<h1 id="-6-create-a-reusable-cli-tool">‚úÖ 6. CREATE a reusable CLI tool</h1>
<p><code>jsondb.sh</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh
</span></span></span><span style="display:flex;"><span>DB<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>CMD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$2<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>shift <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;</span>$CMD<span style="color:#e6db74">&#34;</span> in
</span></span><span style="display:flex;"><span>  find<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    jq -c <span style="color:#e6db74">&#34;select(</span>$1<span style="color:#e6db74">)&#34;</span> <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  insert<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> &gt;&gt; <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  delete<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    jq -c <span style="color:#e6db74">&#34;select((</span>$1<span style="color:#e6db74">) | not)&#34;</span> <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span> &gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  update<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>   <span style="color:#75715e"># e.g. &#39;.id == 2&#39;</span>
</span></span><span style="display:flex;"><span>    update<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$2<span style="color:#e6db74">&#34;</span>   <span style="color:#75715e"># e.g. &#39;.email = &#34;x@y.com&#34;&#39;</span>
</span></span><span style="display:flex;"><span>    jq -c <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      if (</span>$filter<span style="color:#e6db74">) then </span>$update<span style="color:#e6db74"> else . end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;</span> <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span> &gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp <span style="color:#e6db74">&#34;</span>$DB<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  *<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Commands: find / insert / delete / update&#34;</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">esac</span>
</span></span></code></pre></div><p>Example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>./jsondb.sh users.ndjson find <span style="color:#e6db74">&#39;.id == 1&#39;</span>
</span></span><span style="display:flex;"><span>./jsondb.sh users.ndjson insert <span style="color:#e6db74">&#39;{&#34;id&#34;:4,&#34;name&#34;:&#34;D&#34;,&#34;email&#34;:&#34;d@mail&#34;}&#39;</span>
</span></span><span style="display:flex;"><span>./jsondb.sh users.ndjson delete <span style="color:#e6db74">&#39;.id == 2&#39;</span>
</span></span><span style="display:flex;"><span>./jsondb.sh users.ndjson update <span style="color:#e6db74">&#39;.id == 3&#39;</span> <span style="color:#e6db74">&#39;.name = &#34;Carol X&#34;&#39;</span>
</span></span></code></pre></div><hr>
<h1 id="want-more">Want more?</h1>
<p>I can generate:</p>
<ul>
<li>a full <strong>query language</strong> (where, select, limit, order by)</li>
<li>automatic <strong>primary key indexing</strong></li>
<li>multi-table JSON structure</li>
<li>a ‚Äútransaction log‚Äù version</li>
<li>CLI with subcommands and help text</li>
</ul>
<p>Just tell me what you&rsquo;d like to build next.</p>

</div>


      </div>
    </section>
  </section><script 
src="/quiz/quizdown.js">
</script>
<script 
src="/quiz/quizdownKatex.js">
</script>
<script 
src="/quiz/quizdownHighlight.js">
</script>
<script>quizdown.register(quizdownHighlight).register(quizdownKatex).init()</script> 
<footer class="footer">
  <div class="content has-text-centered">
    
    
    <p>
      
      <a class="" href="https://imlauera.github.io/index.xml" target="_blank">
        <span>
          RSS
        </span>
      </a>
      
      | <a href="https://imlauera.github.io" target="_blank">Andres Imlauer.</a> 

      
      
    </p>
    
  </div>




<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]} })
</script>
</footer>


</body>
</html>
