<!DOCTYPE html>
<html lang="es">





<head>
  <meta property="og:url" content="https://imlauera.github.io/millones_aplicaciones_hackeadas/">
  <meta property="og:site_name" content="Imlauer">
  <meta property="og:title" content="Millones de aplicaciones vulneradas: como ejecutar código remoto sobre millones de personas y cientas aplicaciones.">
  <meta property="og:description" content="Fuente: https://kibty.town/blog/todesktop/
Traducción:
Esto empezó cuando estaba mirando cursor, un editor con inteligencia artificial. Yo uso lulu por visión de objetos en mi laptop, así que cuando descargué el instalador de cursor obtuve este pop-up:
A LuLu alert, showing that “Install Cursor” was trying to connect to “download.todeskt Una alerta de LuLu, mostrando que “Install Cursor” estaba intentando conectarse a “https://download.todesktop.com”
Ahora, ¿qué es todesktop? Pensé que estaba descargando cursor. Mirando en su sitio aparenta ser un servicio bundler[1] además de proveer un SDK[2] para aplicaciones de electron. Así que aparentemente el instalador que descargué está en realidad controlado por todesktop, no cursor.">
  <meta property="og:locale" content="es_es">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2025-03-01T22:31:57-03:00">
    <meta property="article:modified_time" content="2025-03-01T22:31:57-03:00">
    <meta property="article:tag" content="Hacking">

  
  <meta itemprop="name" content="Millones de aplicaciones vulneradas: como ejecutar código remoto sobre millones de personas y cientas aplicaciones.">
  <meta itemprop="description" content="Fuente: https://kibty.town/blog/todesktop/
Traducción:
Esto empezó cuando estaba mirando cursor, un editor con inteligencia artificial. Yo uso lulu por visión de objetos en mi laptop, así que cuando descargué el instalador de cursor obtuve este pop-up:
A LuLu alert, showing that “Install Cursor” was trying to connect to “download.todeskt Una alerta de LuLu, mostrando que “Install Cursor” estaba intentando conectarse a “https://download.todesktop.com”
Ahora, ¿qué es todesktop? Pensé que estaba descargando cursor. Mirando en su sitio aparenta ser un servicio bundler[1] además de proveer un SDK[2] para aplicaciones de electron. Así que aparentemente el instalador que descargué está en realidad controlado por todesktop, no cursor.">
  <meta itemprop="datePublished" content="2025-03-01T22:31:57-03:00">
  <meta itemprop="dateModified" content="2025-03-01T22:31:57-03:00">
  <meta itemprop="wordCount" content="1163">
  <meta itemprop="keywords" content="Hacking">
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Millones de aplicaciones vulneradas: como ejecutar código remoto sobre millones de personas y cientas aplicaciones.">
  <meta name="twitter:description" content="Fuente: https://kibty.town/blog/todesktop/
Traducción:
Esto empezó cuando estaba mirando cursor, un editor con inteligencia artificial. Yo uso lulu por visión de objetos en mi laptop, así que cuando descargué el instalador de cursor obtuve este pop-up:
A LuLu alert, showing that “Install Cursor” was trying to connect to “download.todeskt Una alerta de LuLu, mostrando que “Install Cursor” estaba intentando conectarse a “https://download.todesktop.com”
Ahora, ¿qué es todesktop? Pensé que estaba descargando cursor. Mirando en su sitio aparenta ser un servicio bundler[1] además de proveer un SDK[2] para aplicaciones de electron. Así que aparentemente el instalador que descargué está en realidad controlado por todesktop, no cursor.">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
    Millones de aplicaciones vulneradas: como ejecutar código remoto sobre millones de personas y cientas aplicaciones.
    
  </title>
  <link rel="stylesheet" href='https://imlauera.github.io/css/site.min.css'>
  <link rel="canonical" href="https://imlauera.github.io/millones_aplicaciones_hackeadas/">
  <link rel="alternate" type="application/rss&#43;xml" href="https://imlauera.github.io/index.xml" title="Imlauer">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer">
  <meta name="author" content="Imlauer.">
  <meta name="description" content="Fuente: https://kibty.town/blog/todesktop/
Traducción:
Esto empezó cuando estaba mirando cursor, un editor con inteligencia artificial. Yo uso lulu por visión de objetos en mi laptop, así que cuando descargué el instalador de cursor obtuve este pop-up:

A LuLu alert, showing that &ldquo;Install Cursor&rdquo; was trying to connect to &ldquo;download.todeskt
Una alerta de LuLu, mostrando que &ldquo;Install Cursor&rdquo; estaba intentando conectarse a &ldquo;https://download.todesktop.com&rdquo;
Ahora, ¿qué es todesktop? Pensé que estaba descargando cursor. Mirando en su sitio aparenta ser un servicio bundler[1] además de proveer un SDK[2] para aplicaciones de electron. Así que aparentemente el instalador que descargué está en realidad controlado por todesktop, no cursor.">
</head>
<body><nav class="navbar is-transparent " role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://imlauera.github.io/">
      <figure class="image">
        <img alt="" class="is-rounded" src="/img/memememe.jpg">
      </figure>
    </a>
    <a class="navbar-item" href="https://imlauera.github.io/">
      Imlauer
    </a>
    <a class="navbar-item" href="/acerca/">
      Acerca de Mi
    </a>
  </div>
  
  
</nav>

  <section>
    <section class='hero is-small is-link is-fullwidth'>
      <div class="hero-body">
<div class="container">
  <h1 class="title">
    Millones de aplicaciones vulneradas: como ejecutar código remoto sobre millones de personas y cientas aplicaciones.
  </h1>
  <h2 class="subtitle">
    <time datetime='2025-03-01T22:31:57-03:00'>
      March 01, 2025
    </time>
    
    <br>
    
    
    
    <a class="tag is-info" href="https://imlauera.github.io/tags/hacking/">Hacking</a>
    
    
    
  </h2>
</div>

      </div>
    </section>
    <section class="section">
      <div class="container">
<div class="content is-medium">
  <p>Fuente: <a href="https://kibty.town/blog/todesktop/">https://kibty.town/blog/todesktop/</a></p>
<p><strong>Traducción</strong>:</p>
<p>Esto empezó cuando estaba mirando cursor, un editor con inteligencia artificial. Yo uso lulu por visión de objetos en mi laptop, así que cuando descargué el instalador de cursor obtuve este pop-up:</p>
<p><img src="https://kibty.town/files/img/posts/todesktop/lulu-alert.png" alt="lulu"></p>
<p>A LuLu alert, showing that &ldquo;Install Cursor&rdquo; was trying to connect to &ldquo;download.todeskt
Una alerta de LuLu, mostrando que &ldquo;Install Cursor&rdquo; estaba intentando conectarse a &ldquo;<a href="https://download.todesktop.com">https://download.todesktop.com</a>&rdquo;</p>
<p>Ahora, ¿qué es todesktop? Pensé que estaba descargando cursor. Mirando en su sitio aparenta ser un servicio bundler[1] además de proveer un SDK[2] para aplicaciones de electron. Así que aparentemente el instalador que descargué está en realidad controlado por <strong>todesktop</strong>, no cursor.</p>
<p>Esto me despertó la curiosidad y me cree una cuenta en <strong>todesktop</strong> para investigar, y cuando apreté el botón de login de GitHub, vi mi llamada a Firebase.</p>
<h5 id="basic-firebase-recon3">basic firebase recon[3]</h5>
<p>Cuando me dí cuenta que la aplicación usaba firestore (es una base de datos no-sql de firebase que es frecuentemente usada en frontend), rápidamente abrí mi devtools(F12 o Control+Shift+i en cualquier navegador) y empecé a hacer basic recon[3] en el firebase.</p>
<p>Me dí cuenta que el sitio tenía sourcemaps, que hicieron que la búsqueda de todos los caminos de firestore usados en aplicación sea más fácil (sigue siendo fácil sin los sourcemaps)</p>
<p>Luego encontré una colección insegura, temporaryApplications, que parecía darme una lista de nombres de algunas aplicaciones (edito: <strong>todesktop</strong> aclaró que esta colección no tiene información sensible y no fue actualizada desde el 2022), pero no encontré más que eso, todo parecía seguro en el firebase salvo de eso.</p>
<p>Me dí cuenta de que la mayoría del deployment y la lógica general pasa en la terminal con el paquete de npm llamado: <code>@todesktop/cli</code>, así que lo instalé y comencé a investigarlo.</p>
<p>El cli (command line interface) administra deployments, subida de código de fuente, y mucho más. La página parece ser una shell para crear aplicaciones, ver deployments, etc etc.</p>
<p>Yo fui otra vez suertudo que el cli también tenía sourcemaps, así que usé el <code>sourcemapper</code> para extraerlos en un árbol source.</p>
<p>Observando ahí, encontré una vulnerabilidad arbitraria s3 a través de una función de firebase llamada <code>getSignedURL</code>, pero no tenía una clave s3 (ruta de archivo) para subir a eso haría algo interesante, así que seguí buscando.</p>
<h5 id="hijacking4-la-tubería-de-deployment-a-través-de-un-script-post-install">hijacking[4] la tubería de deployment a través de un script post-install</h5>
<p>Quería obtener acceso a la máquina en donde la aplicación se construye y la forma más fácil de hacerlo es a través de un script postinstall en el package.json, así que hice eso con un <code>simple reverse shell payload</code>.</p>
<p>Esto funcionó. Navegando a través del contenedor, descubrí donde estaba vivía el código de compilación de la aplicación y encontré esto:</p>
<p><img src="https://kibty.town/files/img/posts/todesktop/config-encrypted.png" alt="configprodjsonencrypted"></p>
<p>Encontré el código para descifrar este archivo, y esto es lo que obtuve luego de descifrarlo:</p>
<p><img src="https://kibty.town/files/img/posts/todesktop/config-json.png" alt="config-json"></p>
<p>Un archivo llamado &ldquo;config.json&rdquo; con 2 id de apple, firma remota y credenciales hsm. Este contenedor guarda los secretos.</p>
<p>Investigando más en el contenedor, encontré una clave de administrador de firebase hardcodeada (que estaba completa).</p>
<h5 id="post-exploitation">post-exploitation</h5>
<p>Rápidamente me dí cuenta que con las credenciales que tengo, puedo deployar una actualización automática a cualquier aplicación que quiera, y que los clientes reciban la actualización inmediatamente al reiniciar la aplicación.</p>
<p>Luego hice un código para usar mis credenciales para deployar una actualización a mi aplicación, y funcionó. Inmediatamente recibí la actualización en mi cliente de mi aplicación y obtuve un <strong>Remote Code Execution</strong>.</p>
<h5 id="hablemos-sobre-el-impacto">Hablemos sobre el impacto</h5>
<p>Con esto podría publicar actualizaciones automáticas a todas las aplicaciones que usan <strong>todesktop</strong>, como por ejemplo:</p>
<ul>
<li>clickup (<a href="https://clickup.com">https://clickup.com</a>)</li>
<li>cursor (<a href="https://cursor.com">https://cursor.com</a>) (update: cursor has now switched off of todesktop to</li>
<li>their own build system)</li>
<li>linear (<a href="https://linear.app">https://linear.app</a>)</li>
<li>notion calendar (<a href="https://calendar.notion.so">https://calendar.notion.so</a>)</li>
</ul>
<p>(Por favor no acoses a esas empresas o hacerlo ver como si fuera su culpa, ellos no la tienen, si alguien acá tiene la culpa es <strong>todesktop</strong>.)</p>
<p>Si hago una estimación probablemente está en el rango de miles de millones de personas en el entorno de tecnología, otros hackers, programadores, ejecutivos, etc. <strong>Haciendo que este exploit sea mortal si es usado</strong>.</p>
<h5 id="el-arreglo">El arreglo</h5>
<p>Usé mis contactos para comunicarme con el creador de <strong>todesktop</strong>, chateamos por signal y el arreglo llegó de inmediato, ellos fueron lo suficientemente amables para compensarme por mis esfuerzos y fueron muy amables.</p>
<p>El contenedor build ahora tiene un privilegiado &ldquo;sidecar&rdquo;(acompañante)[5] que hace el firmado, y la subida y todo lo demás <strong>en vez de que esta lógica esté en el código de usuario del contenedor principal</strong>.</p>
<p>Los incidentes de seguridad pasan todo el tiempo, es natural. Lo que impora es la respuesta de la empresa, y la respuesta de <strong>todesktop</strong> fue buenísima.</p>
<p>Mirá el reporte de <strong>todesktop</strong> acá: <a href="https://www.todesktop.com/blog/posts/security-incident-at-todesktop">https://www.todesktop.com/blog/posts/security-incident-at-todesktop</a></p>
<hr>
<h5 id="definiciones-y-referencias">Definiciones y referencias:</h5>
<ol>
<li>En Electron, un servicio bundler se refiere a una herramienta que ayuda a empaquetar y preparar una aplicación Electron para su distribución. Un bundler es responsable de recopilar todos los archivos y recursos necesarios para ejecutar la aplicación, como el código JavaScript, los archivos de recursos, las bibliotecas y las dependencias, y empaquetarlos en un formato que pueda ser ejecutado en diferentes plataformas.</li>
<li>Un SDK (Kit de Desarrollo de Software) es un conjunto de herramientas de desarrollo que permite a los programadores crear aplicaciones en este caso para Electron. Un SDK proporciona un conjunto de bibliotecas, frameworks, herramientas y documentación que facilitan la creación, prueba y depuración de aplicaciones Android.</li>
<li>Basic Firebase Recon es un conjunto de técnicas y herramientas utilizadas para realizar una investigación y análisis inicial de la configuración y seguridad de un proyecto de Firebase. Firebase es una plataforma de Google que ofrece una variedad de servicios para el desarrollo de aplicaciones web y móviles, incluyendo bases de datos, almacenamiento de archivos, autenticación de usuarios y más. El objetivo de un Basic Firebase Recon es identificar posibles vulnerabilidades y debilidades en la configuración de seguridad de un proyecto de Firebase, lo que puede incluir:</li>
<li>&ldquo;Hijacking&rdquo; es un término que se utiliza en varios contextos para describir la toma ilegal o no autorizada del control de algo.</li>
<li><strong>Build Container</strong>:
Un Build Container es un contenedor que se ejecuta durante el proceso de creación de una imagen de Docker. Su propósito es compilar y construir el código fuente de una aplicación, creando así la imagen de Docker final que se puede ejecutar en producción. El Build Container tiene acceso a todos los archivos y recursos necesarios para compilar y construir la aplicación, incluyendo el código fuente, las dependencias y las herramientas de compilación.</li>
</ol>
<p><strong>Privileged Sidecar</strong>:
Un Privileged Sidecar es un tipo de contenedor que se ejecuta con privilegios de root (o con permisos elevados) en el host que lo ejecuta.</p>
<p><strong>Privileged Sidecar de un Build Container</strong>:
En este contexto, un Privileged Sidecar de un Build Container es un contenedor que se ejecuta con privilegios de root (o con permisos elevados) y que se utiliza como un acompañante (sidecar) del Build Container. Su propósito es proporcionar acceso a recursos del sistema operativo del host que sean necesarios para el proceso de construcción de la aplicación, pero que no sean accesibles desde el Build Container estándar.</p>

</div>


      </div>
    </section>
  </section><script 
src="/quiz/quizdown.js">
</script>
<script 
src="/quiz/quizdownKatex.js">
</script>
<script 
src="/quiz/quizdownHighlight.js">
</script>
<script>quizdown.register(quizdownHighlight).register(quizdownKatex).init()</script> 
<footer class="footer">
  <div class="content has-text-centered">
    
    
    <p>
      
      <a class="" href="https://imlauera.github.io/index.xml" target="_blank">
        <span>
          RSS
        </span>
      </a>
      
      | <a href="https://imlauera.github.io" target="_blank">Andres Imlauer.</a> 

      
      
    </p>
    
  </div>




<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]} })
</script>
</footer>


</body>
</html>
