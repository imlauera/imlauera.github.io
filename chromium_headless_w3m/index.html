<!DOCTYPE html>
<html lang="es">





<head>
  <meta property="og:url" content="https://imlauera.github.io/chromium_headless_w3m/">
  <meta property="og:site_name" content="Imlauer">
  <meta property="og:title" content="Chromium headless w3m">
  <meta property="og:description" content="Intentamos renderizar upwork.com con headless chromium, a ver donde nos lleva Como siempre Cloudflare arruinando Internet y bloqueando todo.
The issue you’re facing is that Cloudflare is detecting your headless browser and blocking it. Here are several solutions:
Quick Fixes 1. Add user agent and disable headless detection:
chromium --headless=new --user-data-dir=$HOME/.config/chromium-headless --disable-gpu --disable-blink-features=AutomationControlled --user-agent=&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#34; --dump-dom --virtual-time-budget=10000 &#34;$1&#34; | sed &#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=$1&gt;|g&#34; | w3m -T text/html Key changes:">
  <meta property="og:locale" content="es_es">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2025-12-31T13:45:04-03:00">
    <meta property="article:modified_time" content="2025-12-31T13:45:04-03:00">

  
  <meta itemprop="name" content="Chromium headless w3m">
  <meta itemprop="description" content="Intentamos renderizar upwork.com con headless chromium, a ver donde nos lleva Como siempre Cloudflare arruinando Internet y bloqueando todo.
The issue you’re facing is that Cloudflare is detecting your headless browser and blocking it. Here are several solutions:
Quick Fixes 1. Add user agent and disable headless detection:
chromium --headless=new --user-data-dir=$HOME/.config/chromium-headless --disable-gpu --disable-blink-features=AutomationControlled --user-agent=&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#34; --dump-dom --virtual-time-budget=10000 &#34;$1&#34; | sed &#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=$1&gt;|g&#34; | w3m -T text/html Key changes:">
  <meta itemprop="datePublished" content="2025-12-31T13:45:04-03:00">
  <meta itemprop="dateModified" content="2025-12-31T13:45:04-03:00">
  <meta itemprop="wordCount" content="2388">
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Chromium headless w3m">
  <meta name="twitter:description" content="Intentamos renderizar upwork.com con headless chromium, a ver donde nos lleva Como siempre Cloudflare arruinando Internet y bloqueando todo.
The issue you’re facing is that Cloudflare is detecting your headless browser and blocking it. Here are several solutions:
Quick Fixes 1. Add user agent and disable headless detection:
chromium --headless=new --user-data-dir=$HOME/.config/chromium-headless --disable-gpu --disable-blink-features=AutomationControlled --user-agent=&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#34; --dump-dom --virtual-time-budget=10000 &#34;$1&#34; | sed &#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=$1&gt;|g&#34; | w3m -T text/html Key changes:">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
    Chromium headless w3m
    
  </title>
  <link rel="stylesheet" href='https://imlauera.github.io/css/site.min.css'>
  <link rel="canonical" href="https://imlauera.github.io/chromium_headless_w3m/">
  <link rel="alternate" type="application/rss&#43;xml" href="https://imlauera.github.io/index.xml" title="Imlauer">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer">
  <meta name="author" content="Imlauer.">
  <meta name="description" content="Intentamos renderizar upwork.com con headless chromium, a ver donde nos lleva
Como siempre Cloudflare arruinando Internet y bloqueando todo.
The issue you&rsquo;re facing is that Cloudflare is detecting your headless browser and blocking it. Here are several solutions:
Quick Fixes
1. Add user agent and disable headless detection:
chromium --headless=new --user-data-dir=$HOME/.config/chromium-headless --disable-gpu --disable-blink-features=AutomationControlled --user-agent=&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#34; --dump-dom --virtual-time-budget=10000 &#34;$1&#34; | sed &#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=$1&gt;|g&#34; | w3m -T text/html
Key changes:">
</head>
<body><nav class="navbar is-transparent " role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://imlauera.github.io/">
      <figure class="image">
        <img alt="" class="is-rounded" src="/img/memememe.jpg">
      </figure>
    </a>
    <a class="navbar-item" href="https://imlauera.github.io/">
      Imlauer
    </a>
    <a class="navbar-item" href="/acerca/">
      Acerca de Mi
    </a>
  </div>
  
  
</nav>

  <section>
    <section class='hero is-small is-link is-fullwidth'>
      <div class="hero-body">
<div class="container">
  <h1 class="title">
    Chromium headless w3m
  </h1>
  <h2 class="subtitle">
    <time datetime='2025-12-31T13:45:04-03:00'>
      December 31, 2025
    </time>
    
  </h2>
</div>

      </div>
    </section>
    <section class="section">
      <div class="container">
<div class="content is-medium">
  <p>Intentamos renderizar upwork.com con headless chromium, a ver donde nos lleva
Como siempre Cloudflare arruinando Internet y bloqueando todo.</p>
<p>The issue you&rsquo;re facing is that Cloudflare is detecting your headless browser and blocking it. Here are several solutions:</p>
<h2 id="quick-fixes">Quick Fixes</h2>
<p><strong>1. Add user agent and disable headless detection:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chromium --headless<span style="color:#f92672">=</span>new --user-data-dir<span style="color:#f92672">=</span>$HOME/.config/chromium-headless --disable-gpu --disable-blink-features<span style="color:#f92672">=</span>AutomationControlled --user-agent<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#34;</span> --dump-dom --virtual-time-budget<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> | sed <span style="color:#e6db74">&#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=</span>$1<span style="color:#e6db74">&gt;|g&#34;</span> | w3m -T text/html
</span></span></code></pre></div><p>Key changes:</p>
<ul>
<li><code>--headless=new</code> - Uses newer headless mode that&rsquo;s harder to detect</li>
<li><code>--disable-blink-features=AutomationControlled</code> - Removes automation flags</li>
<li>Custom user agent that looks like a real browser</li>
<li><strong>Different user-data-dir</strong> to avoid conflicts with your open Chromium</li>
</ul>
<p><strong>2. Increase wait time for JavaScript execution:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chromium --headless<span style="color:#f92672">=</span>new --user-data-dir<span style="color:#f92672">=</span>$HOME/.config/chromium-headless --disable-gpu --disable-blink-features<span style="color:#f92672">=</span>AutomationControlled --virtual-time-budget<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span> --dump-dom <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> | sed <span style="color:#e6db74">&#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=</span>$1<span style="color:#e6db74">&gt;|g&#34;</span> | w3m -T text/html
</span></span></code></pre></div><p>Increase <code>--virtual-time-budget</code> to 30000 (30 seconds) or more.</p>
<p><strong>3. Use a separate profile (fixes the conflict with open Chromium):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chromium --headless<span style="color:#f92672">=</span>new --user-data-dir<span style="color:#f92672">=</span>/tmp/chromium-w3m --disable-gpu --disable-blink-features<span style="color:#f92672">=</span>AutomationControlled --dump-dom --virtual-time-budget<span style="color:#f92672">=</span><span style="color:#ae81ff">15000</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> | sed <span style="color:#e6db74">&#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=</span>$1<span style="color:#e6db74">&gt;|g&#34;</span> | w3m -T text/html
</span></span></code></pre></div><h2 id="alternative-approaches">Alternative Approaches</h2>
<p><strong>Use Playwright or Puppeteer with stealth plugins</strong> (more reliable for Cloudflare):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Install playwright</span>
</span></span><span style="display:flex;"><span>pip install playwright
</span></span><span style="display:flex;"><span>playwright install chromium
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Simple script (save as fetch.py):</span>
</span></span><span style="display:flex;"><span>from playwright.sync_api import sync_playwright
</span></span><span style="display:flex;"><span>import sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>with sync_playwright<span style="color:#f92672">()</span> as p:
</span></span><span style="display:flex;"><span>    browser <span style="color:#f92672">=</span> p.chromium.launch<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> browser.new_page<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    page.goto<span style="color:#f92672">(</span>sys.argv<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>, wait_until<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;networkidle&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    print<span style="color:#f92672">(</span>page.content<span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>    browser.close<span style="color:#f92672">()</span>
</span></span></code></pre></div><p>Then use: <code>python fetch.py &quot;$1&quot; | w3m -T text/html</code></p>
<p><strong>Use curl with JavaScript rendering services:</strong>
Some sites offer APIs that render JavaScript, though this depends on your use case.</p>
<p>The main issue is Cloudflare&rsquo;s bot detection. The separate <code>--user-data-dir</code> should fix your &ldquo;cannot use while chromium is open&rdquo; problem, and the anti-detection flags should help with Cloudflare.</p>
<h4 id="para-scrollear-la-pagina">Para scrollear la pagina:</h4>
<p>Para hacer scroll en la página antes de hacer el dump del DOM, necesitas usar un script. Aquí tienes varias opciones:</p>
<h2 id="opción-1-script-simple-de-nodejs-con-puppeteer">Opción 1: Script simple de Node.js con Puppeteer</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install puppeteer puppeteer-extra puppeteer-extra-plugin-stealth
</span></span></code></pre></div><p>Crea un archivo <code>scroll-fetch.js</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">puppeteer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;puppeteer-extra&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">StealthPlugin</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;puppeteer-extra-plugin-stealth&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">puppeteer</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">StealthPlugin</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">browser</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">puppeteer</span>.<span style="color:#a6e22e">launch</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">headless</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;new&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">args</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;--no-sandbox&#39;</span>, <span style="color:#e6db74">&#39;--disable-setuid-sandbox&#39;</span>]
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">page</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">browser</span>.<span style="color:#a6e22e">newPage</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">page</span>.<span style="color:#66d9ef">goto</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">argv</span>[<span style="color:#ae81ff">2</span>], { <span style="color:#a6e22e">waitUntil</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;networkidle2&#39;</span>, <span style="color:#a6e22e">timeout</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30000</span> });
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Scroll gradualmente
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">page</span>.<span style="color:#a6e22e">evaluate</span>(<span style="color:#66d9ef">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">totalHeight</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">distance</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">timer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">setInterval</span>(() =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scrollHeight</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">scrollHeight</span>;
</span></span><span style="display:flex;"><span>        window.<span style="color:#a6e22e">scrollBy</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">distance</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">totalHeight</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">distance</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">totalHeight</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">scrollHeight</span>){
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">clearInterval</span>(<span style="color:#a6e22e">timer</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">resolve</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }, <span style="color:#ae81ff">100</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Esperar un poco más después del scroll
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">page</span>.<span style="color:#a6e22e">waitForTimeout</span>(<span style="color:#ae81ff">2000</span>);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">html</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">page</span>.<span style="color:#a6e22e">content</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">html</span>);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">browser</span>.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>})();
</span></span></code></pre></div><p>Úsalo así:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>node scroll-fetch.js <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> | w3m -T text/html
</span></span></code></pre></div><h2 id="opción-2-script-python-con-playwright">Opción 2: Script Python con Playwright</h2>
<p>Crea <code>scroll-fetch.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> playwright.sync_api <span style="color:#f92672">import</span> sync_playwright
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> sync_playwright() <span style="color:#66d9ef">as</span> p:
</span></span><span style="display:flex;"><span>    browser <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>chromium<span style="color:#f92672">.</span>launch(headless<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> browser<span style="color:#f92672">.</span>new_page()
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>goto(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>], wait_until<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;networkidle&#39;</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Scroll gradual</span>
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            return new Promise((resolve) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let totalHeight = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let distance = 100;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let timer = setInterval(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    window.scrollBy(0, distance);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    totalHeight += distance;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    if(totalHeight &gt;= document.body.scrollHeight){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        clearInterval(timer);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        resolve();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }, 100);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            });
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    print(page<span style="color:#f92672">.</span>content())
</span></span><span style="display:flex;"><span>    browser<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p>Úsalo así:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python scroll-fetch.py <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> | w3m -T text/html
</span></span></code></pre></div><h2 id="opción-3-con-chrome-devtools-protocol-directamente">Opción 3: Con Chrome DevTools Protocol directamente</h2>
<p>Si prefieres seguir usando chromium directamente, puedes crear un script que use CDP:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># scroll-chrome.sh</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">9222</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Inicia Chrome en modo headless con debugging</span>
</span></span><span style="display:flex;"><span>chromium --headless<span style="color:#f92672">=</span>new --remote-debugging-port<span style="color:#f92672">=</span>$PORT --user-data-dir<span style="color:#f92672">=</span>/tmp/chrome-scroll &amp;
</span></span><span style="display:flex;"><span>CHROME_PID<span style="color:#f92672">=</span>$!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sleep <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Usa curl para enviar comandos CDP</span>
</span></span><span style="display:flex;"><span>python3 <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import json, requests, time
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Obtener la lista de targets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tabs = requests.get(&#39;http://localhost:$PORT/json&#39;).json()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ws_url = tabs[0][&#39;webSocketDebuggerUrl&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Aquí necesitarías websocket para comandos más complejos
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># O usar una herramienta como chrome-remote-interface
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kill $CHROME_PID
</span></span></code></pre></div><h2 id="opción-4-solución-más-simple-con-delay">Opción 4: Solución más simple con delay</h2>
<p>Si solo necesitas que cargue más contenido lazy-load:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chromium --headless<span style="color:#f92672">=</span>new <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  --user-data-dir<span style="color:#f92672">=</span>/tmp/chromium-w3m <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  --disable-gpu <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  --disable-blink-features<span style="color:#f92672">=</span>AutomationControlled <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  --virtual-time-budget<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  --dump-dom <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> | sed <span style="color:#e6db74">&#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=</span>$1<span style="color:#e6db74">&gt;|g&#34;</span> | w3m -T text/html
</span></span></code></pre></div><p>Aumenta <code>--virtual-time-budget</code> a 30000-60000 ms.</p>
<p><strong>Recomendación:</strong> La opción con Puppeteer o Playwright (opciones 1 y 2) es la más confiable para Cloudflare y te da control total sobre el scroll. ¿Cuál prefieres probar?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#chromium --headless $1 --disable-gpu --run-all-compositor-stages-before-draw --dump-dom --virtual-time-budget=10000 | sed &#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=$1&gt;|g&#34; | w3m -T text/html</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#chromium --headless --user-data-dir=$HOME/.config/chromium --profile-directory=Default --disable-gpu --run-all-compositor-stages-before-draw --dump-dom --virtual-time-budget=10000 &#34;$1&#34; | sed &#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=$1&gt;|g&#34; | w3m -T text/html</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#chromium --headless=new --user-data-dir=$HOME/.config/chromium-headless --disable-gpu --disable-blink-features=AutomationControlled --virtual-time-budget=30000 --dump-dom &#34;$1&#34; | sed &#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=$1&gt;|g&#34; | w3m -T text/html</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#chromium --headless=new --user-data-dir=$HOME/.config/chromium-headless --disable-gpu --disable-blink-features=AutomationControlled --virtual-time-budget=30000 --user-agent=&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#34; --dump-dom --virtual-time-budget=10000 &#34;$1&#34; | sed &#34;s|&lt;head&gt;|&lt;head&gt;&lt;base href=$1&gt;|g&#34; | w3m -T text/html</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#chromium --headless $1 --run-all-compositor-stages-before-draw --dump-dom --virtual-time-budget=10000 | monolith - -I -b $1 | w3m -T text/html</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>source $HOME/playwright/bin/activate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python $HOME/playwright/fetch.py <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> | w3m -T text/html
</span></span></code></pre></div><p>Perfecto. Aquí tienes la solución completa con Playwright para usar las cookies de tu Chromium:</p>
<h2 id="opción-1-usar-tu-perfil-de-chromium-directamente-chromium-cerrado">Opción 1: Usar tu perfil de Chromium directamente (Chromium cerrado)</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> playwright.sync_api <span style="color:#f92672">import</span> sync_playwright
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> sync_playwright() <span style="color:#66d9ef">as</span> p:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Usar tu perfil de Chromium</span>
</span></span><span style="display:flex;"><span>    browser <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>chromium<span style="color:#f92672">.</span>launch_persistent_context(
</span></span><span style="display:flex;"><span>        user_data_dir<span style="color:#f92672">=</span>os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>expanduser(<span style="color:#e6db74">&#39;~/.config/chromium&#39;</span>),
</span></span><span style="display:flex;"><span>        headless<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,  <span style="color:#75715e"># Debe ser False para usar perfil persistente</span>
</span></span><span style="display:flex;"><span>        channel<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;chromium&#39;</span>,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;--profile-directory=Default&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;--disable-blink-features=AutomationControlled&#39;</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> browser<span style="color:#f92672">.</span>pages[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">if</span> browser<span style="color:#f92672">.</span>pages <span style="color:#66d9ef">else</span> browser<span style="color:#f92672">.</span>new_page()
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>goto(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>], wait_until<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;networkidle&#39;</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Scroll gradual</span>
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            return new Promise((resolve) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let totalHeight = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let distance = 100;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let timer = setInterval(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    window.scrollBy(0, distance);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    totalHeight += distance;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    if(totalHeight &gt;= document.body.scrollHeight){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        clearInterval(timer);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        resolve();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }, 100);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            });
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>wait_for_timeout(<span style="color:#ae81ff">2000</span>)
</span></span><span style="display:flex;"><span>    print(page<span style="color:#f92672">.</span>content())
</span></span><span style="display:flex;"><span>    browser<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p><strong>Nota:</strong> Chromium debe estar cerrado para usar esto.</p>
<h2 id="opción-2-exportar-e-importar-cookies-automáticamente">Opción 2: Exportar e importar cookies automáticamente</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> playwright.sync_api <span style="color:#f92672">import</span> sync_playwright
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sqlite3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> urllib.parse <span style="color:#f92672">import</span> urlparse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_chromium_cookies</span>(url):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Extrae cookies de Chromium sin encriptación compleja&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    domain <span style="color:#f92672">=</span> urlparse(url)<span style="color:#f92672">.</span>netloc
</span></span><span style="display:flex;"><span>    cookie_db <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>expanduser(<span style="color:#e6db74">&#39;~/.config/chromium/Default/Cookies&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Copiar la base de datos porque puede estar bloqueada</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> shutil
</span></span><span style="display:flex;"><span>    temp_db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/tmp/cookies_copy.db&#39;</span>
</span></span><span style="display:flex;"><span>    shutil<span style="color:#f92672">.</span>copy2(cookie_db, temp_db)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    conn <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(temp_db)
</span></span><span style="display:flex;"><span>    cursor <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>cursor()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Buscar cookies del dominio</span>
</span></span><span style="display:flex;"><span>    cursor<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        SELECT host_key, name, encrypted_value, path, expires_utc, is_secure, is_httponly, samesite
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        FROM cookies 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        WHERE host_key LIKE ?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>, (<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;%</span><span style="color:#e6db74">{</span>domain<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#39;</span>,))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    cookies <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> cursor<span style="color:#f92672">.</span>fetchall():
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># encrypted_value puede estar en formato v10 o v11 (Chrome/Chromium en Linux)</span>
</span></span><span style="display:flex;"><span>        encrypted_value <span style="color:#f92672">=</span> row[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Intentar obtener el valor (puede estar sin encriptar en algunos casos)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Nota: En producción necesitarías libsecret para desencriptar</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Si comienza con &#39;v10&#39; o &#39;v11&#39;, está encriptado</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> encrypted_value[:<span style="color:#ae81ff">3</span>] <span style="color:#f92672">in</span> [<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;v10&#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;v11&#39;</span>]:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Aquí necesitarías la clave de encriptación</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Por simplicidad, saltamos cookies encriptadas</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                value <span style="color:#f92672">=</span> encrypted_value<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>, errors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ignore&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        cookies<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;name&#39;</span>: row[<span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;value&#39;</span>: value,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;domain&#39;</span>: row[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;path&#39;</span>: row[<span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;expires&#39;</span>: row[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000000</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">11644473600</span> <span style="color:#66d9ef">if</span> row[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;httpOnly&#39;</span>: bool(row[<span style="color:#ae81ff">6</span>]),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;secure&#39;</span>: bool(row[<span style="color:#ae81ff">5</span>]),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;sameSite&#39;</span>: [<span style="color:#e6db74">&#39;None&#39;</span>, <span style="color:#e6db74">&#39;Lax&#39;</span>, <span style="color:#e6db74">&#39;Strict&#39;</span>][row[<span style="color:#ae81ff">7</span>]] <span style="color:#66d9ef">if</span> row[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;None&#39;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    conn<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>remove(temp_db)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cookies
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> sync_playwright() <span style="color:#66d9ef">as</span> p:
</span></span><span style="display:flex;"><span>    browser <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>chromium<span style="color:#f92672">.</span>launch(headless<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    context <span style="color:#f92672">=</span> browser<span style="color:#f92672">.</span>new_context()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Intentar cargar cookies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        cookies <span style="color:#f92672">=</span> get_chromium_cookies(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cookies:
</span></span><span style="display:flex;"><span>            context<span style="color:#f92672">.</span>add_cookies(cookies)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Warning: No se pudieron cargar cookies: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>new_page()
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>goto(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>], wait_until<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;networkidle&#39;</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Scroll</span>
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            return new Promise((resolve) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let totalHeight = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let distance = 100;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let timer = setInterval(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    window.scrollBy(0, distance);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    totalHeight += distance;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    if(totalHeight &gt;= document.body.scrollHeight){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        clearInterval(timer);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        resolve();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }, 100);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            });
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>wait_for_timeout(<span style="color:#ae81ff">2000</span>)
</span></span><span style="display:flex;"><span>    print(page<span style="color:#f92672">.</span>content())
</span></span><span style="display:flex;"><span>    browser<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h2 id="opción-3-método-manual-más-confiable">Opción 3: Método manual (más confiable)</h2>
<p><strong>Paso 1:</strong> Exportar cookies manualmente con una extensión de Chromium</p>
<p><strong>Paso 2:</strong> Crear el script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> playwright.sync_api <span style="color:#f92672">import</span> sync_playwright
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> sync_playwright() <span style="color:#66d9ef">as</span> p:
</span></span><span style="display:flex;"><span>    browser <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>chromium<span style="color:#f92672">.</span>launch(
</span></span><span style="display:flex;"><span>        headless<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;--disable-blink-features=AutomationControlled&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    context <span style="color:#f92672">=</span> browser<span style="color:#f92672">.</span>new_context()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Cargar cookies desde archivo JSON</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;cookies.json&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>            cookies <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>            context<span style="color:#f92672">.</span>add_cookies(cookies)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">FileNotFoundError</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Warning: cookies.json not found&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>new_page()
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>goto(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>], wait_until<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;networkidle&#39;</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Scroll gradual</span>
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            return new Promise((resolve) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let totalHeight = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let distance = 100;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let timer = setInterval(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    window.scrollBy(0, distance);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    totalHeight += distance;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    if(totalHeight &gt;= document.body.scrollHeight){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        clearInterval(timer);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        resolve();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }, 100);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            });
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>wait_for_timeout(<span style="color:#ae81ff">2000</span>)
</span></span><span style="display:flex;"><span>    print(page<span style="color:#f92672">.</span>content())
</span></span><span style="display:flex;"><span>    browser<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h2 id="opción-4-con-desencriptación-de-cookies-requiere-pycryptodome">Opción 4: Con desencriptación de cookies (requiere pycryptodome)</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install pycryptodome secretstorage
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> playwright.sync_api <span style="color:#f92672">import</span> sync_playwright
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sqlite3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> secretstorage
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Protocol.KDF <span style="color:#f92672">import</span> PBKDF2
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> urllib.parse <span style="color:#f92672">import</span> urlparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> shutil
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_encryption_key</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Obtiene la clave de encriptación de Chromium en Linux&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    bus <span style="color:#f92672">=</span> secretstorage<span style="color:#f92672">.</span>dbus_init()
</span></span><span style="display:flex;"><span>    collection <span style="color:#f92672">=</span> secretstorage<span style="color:#f92672">.</span>get_default_collection(bus)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> collection<span style="color:#f92672">.</span>get_all_items():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>get_label() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Chrome Safe Storage&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> item<span style="color:#f92672">.</span>get_secret()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Fallback: password por defecto</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;peanuts&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt_cookie</span>(encrypted_value, key):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Desencripta una cookie de Chromium&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> encrypted_value[:<span style="color:#ae81ff">3</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;v10&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Usar PBKDF2 para derivar la clave</span>
</span></span><span style="display:flex;"><span>        salt <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;saltysalt&#39;</span>
</span></span><span style="display:flex;"><span>        iv <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>        length <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        derived_key <span style="color:#f92672">=</span> PBKDF2(key, salt, length, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(derived_key, AES<span style="color:#f92672">.</span>MODE_CBC, IV<span style="color:#f92672">=</span>iv)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        decrypted <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>decrypt(encrypted_value[<span style="color:#ae81ff">3</span>:])
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Remover padding</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> decrypted[:<span style="color:#f92672">-</span>decrypted[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]]<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> encrypted_value<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>, errors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ignore&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_chromium_cookies_decrypted</span>(url):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Extrae y desencripta cookies de Chromium&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    domain <span style="color:#f92672">=</span> urlparse(url)<span style="color:#f92672">.</span>netloc
</span></span><span style="display:flex;"><span>    cookie_db <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>expanduser(<span style="color:#e6db74">&#39;~/.config/chromium/Default/Cookies&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    temp_db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/tmp/cookies_copy.db&#39;</span>
</span></span><span style="display:flex;"><span>    shutil<span style="color:#f92672">.</span>copy2(cookie_db, temp_db)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    conn <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(temp_db)
</span></span><span style="display:flex;"><span>    cursor <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>cursor()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    cursor<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        SELECT host_key, name, encrypted_value, path, expires_utc, is_secure, is_httponly, samesite
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        FROM cookies 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        WHERE host_key LIKE ?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>, (<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;%</span><span style="color:#e6db74">{</span>domain<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#39;</span>,))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">=</span> get_encryption_key()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;peanuts&#39;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    cookies <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> cursor<span style="color:#f92672">.</span>fetchall():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            value <span style="color:#f92672">=</span> decrypt_cookie(row[<span style="color:#ae81ff">2</span>], key)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            cookies<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;name&#39;</span>: row[<span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;value&#39;</span>: value,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;domain&#39;</span>: row[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;path&#39;</span>: row[<span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;expires&#39;</span>: row[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000000</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">11644473600</span> <span style="color:#66d9ef">if</span> row[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;httpOnly&#39;</span>: bool(row[<span style="color:#ae81ff">6</span>]),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;secure&#39;</span>: bool(row[<span style="color:#ae81ff">5</span>]),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;sameSite&#39;</span>: [<span style="color:#e6db74">&#39;None&#39;</span>, <span style="color:#e6db74">&#39;Lax&#39;</span>, <span style="color:#e6db74">&#39;Strict&#39;</span>][row[<span style="color:#ae81ff">7</span>]] <span style="color:#66d9ef">if</span> row[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">in</span> [<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>] <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;None&#39;</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    conn<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>remove(temp_db)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cookies
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> sync_playwright() <span style="color:#66d9ef">as</span> p:
</span></span><span style="display:flex;"><span>    browser <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>chromium<span style="color:#f92672">.</span>launch(headless<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    context <span style="color:#f92672">=</span> browser<span style="color:#f92672">.</span>new_context()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        cookies <span style="color:#f92672">=</span> get_chromium_cookies_decrypted(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cookies:
</span></span><span style="display:flex;"><span>            context<span style="color:#f92672">.</span>add_cookies(cookies)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Loaded </span><span style="color:#e6db74">{</span>len(cookies)<span style="color:#e6db74">}</span><span style="color:#e6db74"> cookies&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error loading cookies: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>new_page()
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>goto(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>], wait_until<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;networkidle&#39;</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            return new Promise((resolve) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let totalHeight = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let distance = 100;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let timer = setInterval(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    window.scrollBy(0, distance);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    totalHeight += distance;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    if(totalHeight &gt;= document.body.scrollHeight){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        clearInterval(timer);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        resolve();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }, 100);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            });
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>wait_for_timeout(<span style="color:#ae81ff">2000</span>)
</span></span><span style="display:flex;"><span>    print(page<span style="color:#f92672">.</span>content())
</span></span><span style="display:flex;"><span>    browser<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p><strong>Recomendación:</strong> Empieza con la <strong>Opción 1</strong> (cierra Chromium temporalmente) o la <strong>Opción 4</strong> (desencriptación completa). ¿Cuál prefieres?</p>
<p>El error indica que el perfil de Chromium está siendo usado o hay un problema de permisos. Aquí está la solución:</p>
<h2 id="opción-1-usar-un-perfil-temporal-copiando-las-cookies">Opción 1: Usar un perfil temporal copiando las cookies</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> playwright.sync_api <span style="color:#f92672">import</span> sync_playwright
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> shutil
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> sync_playwright() <span style="color:#66d9ef">as</span> p:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Crear directorio temporal para el perfil</span>
</span></span><span style="display:flex;"><span>    temp_profile <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/tmp/chromium-playwright&#39;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Copiar solo las cookies del perfil original</span>
</span></span><span style="display:flex;"><span>    original_cookies <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>expanduser(<span style="color:#e6db74">&#39;~/.config/chromium/Default/Cookies&#39;</span>)
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>makedirs(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>temp_profile<span style="color:#e6db74">}</span><span style="color:#e6db74">/Default&#39;</span>, exist_ok<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(original_cookies):
</span></span><span style="display:flex;"><span>        shutil<span style="color:#f92672">.</span>copy2(original_cookies, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>temp_profile<span style="color:#e6db74">}</span><span style="color:#e6db74">/Default/Cookies&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Lanzar con el perfil temporal</span>
</span></span><span style="display:flex;"><span>    browser <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>chromium<span style="color:#f92672">.</span>launch_persistent_context(
</span></span><span style="display:flex;"><span>        user_data_dir<span style="color:#f92672">=</span>temp_profile,
</span></span><span style="display:flex;"><span>        headless<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;--disable-blink-features=AutomationControlled&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;--profile-directory=Default&#39;</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> browser<span style="color:#f92672">.</span>pages[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">if</span> browser<span style="color:#f92672">.</span>pages <span style="color:#66d9ef">else</span> browser<span style="color:#f92672">.</span>new_page()
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>goto(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>], wait_until<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;networkidle&#39;</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Scroll gradual</span>
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            return new Promise((resolve) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let totalHeight = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let distance = 100;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let timer = setInterval(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    window.scrollBy(0, distance);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    totalHeight += distance;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    if(totalHeight &gt;= document.body.scrollHeight){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        clearInterval(timer);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        resolve();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }, 100);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            });
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>wait_for_timeout(<span style="color:#ae81ff">2000</span>)
</span></span><span style="display:flex;"><span>    print(page<span style="color:#f92672">.</span>content())
</span></span><span style="display:flex;"><span>    browser<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h2 id="opción-2-usar-la-desencriptación-de-cookies-más-limpio">Opción 2: Usar la desencriptación de cookies (más limpio)</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> playwright.sync_api <span style="color:#f92672">import</span> sync_playwright
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sqlite3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> shutil
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> urllib.parse <span style="color:#f92672">import</span> urlparse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_chromium_cookies</span>(url):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Extrae cookies de Chromium&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    domain <span style="color:#f92672">=</span> urlparse(url)<span style="color:#f92672">.</span>netloc
</span></span><span style="display:flex;"><span>    cookie_db <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>expanduser(<span style="color:#e6db74">&#39;~/.config/chromium/Default/Cookies&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(cookie_db):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> []
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Copiar la base de datos</span>
</span></span><span style="display:flex;"><span>    temp_db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/tmp/cookies_copy.db&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        shutil<span style="color:#f92672">.</span>copy2(cookie_db, temp_db)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error copiando cookies: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> []
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    conn <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(temp_db)
</span></span><span style="display:flex;"><span>    cursor <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>cursor()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Obtener cookies del dominio</span>
</span></span><span style="display:flex;"><span>    cursor<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        SELECT host_key, name, value, path, expires_utc, is_secure, is_httponly, samesite
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        FROM cookies 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        WHERE host_key LIKE ? OR host_key LIKE ?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>, (<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;%</span><span style="color:#e6db74">{</span>domain<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#39;</span>, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;.</span><span style="color:#e6db74">{</span>domain<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    cookies <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> cursor<span style="color:#f92672">.</span>fetchall():
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Usar solo cookies no encriptadas (campo &#39;value&#39;)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> row[<span style="color:#ae81ff">2</span>]:  <span style="color:#75715e"># Si tiene valor en el campo &#39;value&#39;</span>
</span></span><span style="display:flex;"><span>            cookies<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;name&#39;</span>: row[<span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;value&#39;</span>: row[<span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;domain&#39;</span>: row[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;path&#39;</span>: row[<span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;expires&#39;</span>: row[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000000</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">11644473600</span> <span style="color:#66d9ef">if</span> row[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;httpOnly&#39;</span>: bool(row[<span style="color:#ae81ff">6</span>]),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;secure&#39;</span>: bool(row[<span style="color:#ae81ff">5</span>]),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;sameSite&#39;</span>: [<span style="color:#e6db74">&#39;None&#39;</span>, <span style="color:#e6db74">&#39;Lax&#39;</span>, <span style="color:#e6db74">&#39;Strict&#39;</span>][row[<span style="color:#ae81ff">7</span>]] <span style="color:#66d9ef">if</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> row[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;Lax&#39;</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    conn<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        os<span style="color:#f92672">.</span>remove(temp_db)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cookies
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> sync_playwright() <span style="color:#66d9ef">as</span> p:
</span></span><span style="display:flex;"><span>    browser <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>chromium<span style="color:#f92672">.</span>launch(
</span></span><span style="display:flex;"><span>        headless<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;--disable-blink-features=AutomationControlled&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    context <span style="color:#f92672">=</span> browser<span style="color:#f92672">.</span>new_context(
</span></span><span style="display:flex;"><span>        user_agent<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#39;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Cargar cookies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        cookies <span style="color:#f92672">=</span> get_chromium_cookies(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cookies:
</span></span><span style="display:flex;"><span>            context<span style="color:#f92672">.</span>add_cookies(cookies)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Cargadas </span><span style="color:#e6db74">{</span>len(cookies)<span style="color:#e6db74">}</span><span style="color:#e6db74"> cookies&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;No se encontraron cookies&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error cargando cookies: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>new_page()
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>goto(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>], wait_until<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;networkidle&#39;</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Scroll gradual</span>
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            return new Promise((resolve) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let totalHeight = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let distance = 100;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                let timer = setInterval(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    window.scrollBy(0, distance);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    totalHeight += distance;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    if(totalHeight &gt;= document.body.scrollHeight){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        clearInterval(timer);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        resolve();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }, 100);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            });
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>wait_for_timeout(<span style="color:#ae81ff">2000</span>)
</span></span><span style="display:flex;"><span>    print(page<span style="color:#f92672">.</span>content())
</span></span><span style="display:flex;"><span>    browser<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h2 id="opción-3-si-las-cookies-están-encriptadas-usa-esto">Opción 3: Si las cookies están encriptadas, usa esto</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install pycryptodome
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> playwright.sync_api <span style="color:#f92672">import</span> sync_playwright
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sqlite3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> shutil
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> urllib.parse <span style="color:#f92672">import</span> urlparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Protocol.KDF <span style="color:#f92672">import</span> PBKDF2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_encryption_key</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Obtiene la clave de encriptación&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">import</span> secretstorage
</span></span><span style="display:flex;"><span>        bus <span style="color:#f92672">=</span> secretstorage<span style="color:#f92672">.</span>dbus_init()
</span></span><span style="display:flex;"><span>        collection <span style="color:#f92672">=</span> secretstorage<span style="color:#f92672">.</span>get_default_collection(bus)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> collection<span style="color:#f92672">.</span>get_all_items():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>get_label() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Chrome Safe Storage&#39;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> item<span style="color:#f92672">.</span>get_secret()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;peanuts&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt_value</span>(encrypted_value, key):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Desencripta el valor de la cookie&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> encrypted_value[:<span style="color:#ae81ff">3</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;v10&#39;</span> <span style="color:#f92672">or</span> encrypted_value[:<span style="color:#ae81ff">3</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;v11&#39;</span>:
</span></span><span style="display:flex;"><span>        salt <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;saltysalt&#39;</span>
</span></span><span style="display:flex;"><span>        iv <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>        derived_key <span style="color:#f92672">=</span> PBKDF2(key, salt, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(derived_key, AES<span style="color:#f92672">.</span>MODE_CBC, IV<span style="color:#f92672">=</span>iv)
</span></span><span style="display:flex;"><span>        decrypted <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>decrypt(encrypted_value[<span style="color:#ae81ff">3</span>:])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> decrypted[:<span style="color:#f92672">-</span>decrypted[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]]<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> encrypted_value<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>, errors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ignore&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_chromium_cookies</span>(url):
</span></span><span style="display:flex;"><span>    domain <span style="color:#f92672">=</span> urlparse(url)<span style="color:#f92672">.</span>netloc
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Al final terminé usando el de falkon: .config/falkon/profiles/default/Cookies</span>
</span></span><span style="display:flex;"><span>    cookie_db <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>expanduser(<span style="color:#e6db74">&#39;~/.config/chromium/Default/Cookies&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(cookie_db):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> []
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    temp_db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/tmp/cookies_copy.db&#39;</span>
</span></span><span style="display:flex;"><span>    shutil<span style="color:#f92672">.</span>copy2(cookie_db, temp_db)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    conn <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(temp_db)
</span></span><span style="display:flex;"><span>    cursor <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>cursor()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    cursor<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        SELECT host_key, name, value, encrypted_value, path, expires_utc, is_secure, is_httponly, samesite
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        FROM cookies 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        WHERE host_key LIKE ? OR host_key LIKE ?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>, (<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;%</span><span style="color:#e6db74">{</span>domain<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#39;</span>, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;.</span><span style="color:#e6db74">{</span>domain<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> get_encryption_key()
</span></span><span style="display:flex;"><span>    cookies <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> cursor<span style="color:#f92672">.</span>fetchall():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Intentar primero el campo &#39;value&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> row[<span style="color:#ae81ff">2</span>]:
</span></span><span style="display:flex;"><span>                value <span style="color:#f92672">=</span> row[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Si está vacío, desencriptar &#39;encrypted_value&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> row[<span style="color:#ae81ff">3</span>]:
</span></span><span style="display:flex;"><span>                value <span style="color:#f92672">=</span> decrypt_value(row[<span style="color:#ae81ff">3</span>], key)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            cookies<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;name&#39;</span>: row[<span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;value&#39;</span>: value,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;domain&#39;</span>: row[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;path&#39;</span>: row[<span style="color:#ae81ff">4</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;expires&#39;</span>: row[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000000</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">11644473600</span> <span style="color:#66d9ef">if</span> row[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;httpOnly&#39;</span>: bool(row[<span style="color:#ae81ff">7</span>]),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;secure&#39;</span>: bool(row[<span style="color:#ae81ff">6</span>]),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;sameSite&#39;</span>: [<span style="color:#e6db74">&#39;None&#39;</span>, <span style="color:#e6db74">&#39;Lax&#39;</span>, <span style="color:#e6db74">&#39;Strict&#39;</span>][row[<span style="color:#ae81ff">8</span>]] <span style="color:#66d9ef">if</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> row[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;Lax&#39;</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    conn<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>remove(temp_db)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cookies
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> sync_playwright() <span style="color:#66d9ef">as</span> p:
</span></span><span style="display:flex;"><span>    browser <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>chromium<span style="color:#f92672">.</span>launch(headless<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    context <span style="color:#f92672">=</span> browser<span style="color:#f92672">.</span>new_context()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        cookies <span style="color:#f92672">=</span> get_chromium_cookies(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cookies:
</span></span><span style="display:flex;"><span>            context<span style="color:#f92672">.</span>add_cookies(cookies)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;✓ </span><span style="color:#e6db74">{</span>len(cookies)<span style="color:#e6db74">}</span><span style="color:#e6db74"> cookies cargadas&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;✗ Error: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>new_page()
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>goto(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>], wait_until<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;networkidle&#39;</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30000</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        () =&gt; new Promise(resolve =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            let total = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            const int = setInterval(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                window.scrollBy(0, 100);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                total += 100;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                if(total &gt;= document.body.scrollHeight) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    clearInterval(int);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    resolve();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }, 100);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        })
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    page<span style="color:#f92672">.</span>wait_for_timeout(<span style="color:#ae81ff">2000</span>)
</span></span><span style="display:flex;"><span>    print(page<span style="color:#f92672">.</span>content())
</span></span><span style="display:flex;"><span>    browser<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p><strong>Prueba primero la Opción 2</strong> (la más simple). Si las cookies no funcionan porque están encriptadas, usa la Opción 3.</p>
<p>Usa así:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python fetch.py <span style="color:#e6db74">&#34;https://www.upwork.com/tu-url&#34;</span> | w3m -T text/html
</span></span></code></pre></div>
</div>


      </div>
    </section>
  </section><script 
src="/quiz/quizdown.js">
</script>
<script 
src="/quiz/quizdownKatex.js">
</script>
<script 
src="/quiz/quizdownHighlight.js">
</script>
<script>quizdown.register(quizdownHighlight).register(quizdownKatex).init()</script> 
<footer class="footer">
  <div class="content has-text-centered">
    
    
    <p>
      
      <a class="" href="https://imlauera.github.io/index.xml" target="_blank">
        <span>
          RSS
        </span>
      </a>
      
      | <a href="https://imlauera.github.io" target="_blank">Andres Imlauer.</a> 

      
      
    </p>
    
  </div>




<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]} })
</script>
</footer>


</body>
</html>
